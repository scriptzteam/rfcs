<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
]>

<rfc xmlns:xi="http://www.w3.org/2001/XInclude" submissionType="IETF" category="std" consensus="yes" docName="draft-ietf-ippm-stamp-srpm-18" number="9503" ipr="trust200902" obsoletes="" updates="" xml:lang="en" sortRefs="true" symRefs="true" tocInclude="true" version="3">

  <!-- xml2rfc v2v3 conversion 3.12.0 -->
  <!-- Generated by id2xml 1.5.0 on 2020-02-06T01:41:26Z -->
  <front>    
    <title abbrev="STAMP Extensions for SR Networks">Simple Two-Way Active Measurement Protocol (STAMP) Extensions for Segment Routing Networks</title>
    <seriesInfo name="RFC" value="9503"/>
    <author fullname="Rakesh Gandhi" initials="R." role="editor" surname="Gandhi">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <country>Canada</country>
        </postal>
        <email>rgandhi@cisco.com</email>
      </address>
    </author>
    <author fullname="Clarence Filsfils" initials="C." surname="Filsfils">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <email>cfilsfil@cisco.com</email>
      </address>
    </author>
    <author fullname="Mach(Guoyi) Chen" initials="M." surname="Chen">
      <organization>Huawei</organization>
      <address>
        <email>mach.chen@huawei.com</email>
      </address>
    </author>
    <author fullname="Bart Janssens" initials="B." surname="Janssens">
      <organization>Colt</organization>
      <address>
        <email>Bart.Janssens@colt.net</email>
      </address>
    </author>
    <author fullname="Richard Foote" initials="R." surname="Foote">
      <organization>Nokia</organization>
      <address>
        <email>footer.foote@nokia.com</email>
      </address>
    </author>
    <date month="October" year="2023"/>
    <area>tsv</area>
    <workgroup>ippm</workgroup>

    <abstract>
      <t>
   Segment Routing (SR) leverages the source routing paradigm.  SR is
   applicable to both Multiprotocol Label Switching (SR-MPLS) and IPv6
   (SRv6) forwarding planes. This document specifies Simple Two-Way Active Measurement Protocol (STAMP)
   extensions (as described in RFC 8762) for SR networks, for both the SR-MPLS and SRv6 forwarding 
   planes, by augmenting the optional extensions defined in RFC 8972.</t>
    </abstract>
  </front>
  <middle>
    <section anchor="sect-1" numbered="true" toc="default">
      <name>Introduction</name>
      <t>
   Segment Routing (SR) leverages the source routing paradigm 
   for Software-Defined Networks
   (SDNs).  SR is applicable to both Multiprotocol Label Switching
   (SR-MPLS) and IPv6 (SRv6) forwarding planes <xref target="RFC8402" format="default"/>.  
   SR Policies as defined in <xref target="RFC9256" format="default"/> are used
   to steer traffic through specific, user-defined paths using a stack of Segments. 
   A comprehensive SR Performance Measurement (PM) toolset is one of the
   essential requirements to measure network performance to provide Service Level Agreements (SLAs).</t>

      <t>The Simple Two-Way Active Measurement Protocol (STAMP) provides
   capabilities for the measurement of various performance
   metrics in IP networks <xref target="RFC8762" format="default"/> 
   without the use of a control channel to pre-signal session parameters.
   <xref target="RFC8972" format="default"/> defines optional extensions, in the form of TLVs, for STAMP.
   Note that the YANG data model defined in <xref target="I-D.ietf-ippm-stamp-yang" format="default"/>
   can be used to provision the STAMP Session-Sender and STAMP Session-Reflector.</t>

      <t>STAMP test packets are transmitted along an IP path between a Session-Sender 
   and a Session-Reflector to measure performance delay and packet loss along that IP path.  
   In SR networks, it may be desired that the same path (same set of links and nodes) between the 
   Session-Sender and Session-Reflector be used for the STAMP test packets in both directions.  
   This is achieved by using the STAMP <xref target="RFC8762" format="default"/> extensions for 
   SR-MPLS and SRv6 networks as specified in this document by augmenting
   the optional extensions defined in <xref target="RFC8972" format="default"/>.</t>
    </section>
    <section anchor="sect-2" numbered="true" toc="default">
      <name>Conventions Used in This Document</name>
      <section anchor="sect-2.1" numbered="true" toc="default">
        <name>Requirements Language</name>

        <t>
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL
    NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
    described in BCP&nbsp;14 <xref target="RFC2119"/> <xref target="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
        </t>
      </section>
      <section anchor="sect-2.2" numbered="true" toc="default">
        <name>Abbreviations</name>
        <dl spacing="normal">
   <dt>MPLS:</dt><dd> Multiprotocol Label Switching</dd>
   <dt>SID:</dt><dd> Segment Identifier</dd>
   <dt>SR:</dt><dd> Segment Routing</dd>
   <dt>SR-MPLS:</dt><dd> Segment Routing over MPLS</dd>
   <dt>SRv6:</dt><dd> Segment Routing over IPv6</dd>
   <dt>SSID:</dt><dd> STAMP Session Identifier</dd>
   <dt>STAMP:</dt><dd> Simple Two-Way Active Measurement Protocol</dd>
       </dl>
      </section>
      <section anchor="sect-2.3" numbered="true" toc="default">
        <name>Reference Topology</name>
        <t>
   In the reference topology shown below, the STAMP Session-Sender S1 initiates a
   STAMP test packet and the STAMP Session-Reflector R1
   transmits a reply STAMP test packet.
   The reply test packet may be transmitted 
   to the Session-Sender S1 on the same path (same set of links and nodes) or a different path 
   in the reverse direction from the path taken towards the Session-Reflector R1.
	</t><t>

   T1 is a transmit timestamp, and T4 is a receive timestamp added by node S1.
   T2 is a receive timestamp, and T3 is a transmit timestamp added by node R1.
    </t>

        <t>The nodes S1 and R1 may be
   connected via a link or an SR path <xref target="RFC8402" format="default"/>.  
   The link may be a physical interface, virtual link, 
   Link Aggregation Group (LAG) <xref target="IEEE802.1AX" format="default"/>, or LAG member. 
   The SR path may be an SR Policy <xref target="RFC9256" format="default"/> 
	on node S1 (called "head-end") with a destination to node R1 (called "tail-end").</t>

 <figure anchor="Figure_Reference_Topology">
          <name>Reference Topology</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
                       T1                T2
                      /                   \
             +-------+     Test Packet     +-------+
             |       | - - - - - - - - - ->|       |
             |   S1  |=====================|   R1  |
             |       |<- - - - - - - - - - |       |
             +-------+  Reply Test Packet  +-------+
                      \                   /
                       T4                T3

         STAMP Session-Sender        STAMP Session-Reflector
		       ]]></artwork>
 </figure>
      </section>
    </section>
    <section anchor="sect-4" numbered="true" toc="default">
      <name>Destination Node Address TLV</name>
   <t>
   The Session-Sender may need to transmit test packets to the Session-Reflector with a Destination Address that is not a routable address (i.e., not
   suitable for use as the Source Address of the reply test packet)
   of the Session-Reflector. This can be facilitated, for example,
   by encapsulating the STAMP packet by a tunneling protocol; see <xref target="app-A"/>
   for an example. </t>
      
      <t><xref target="RFC8972" format="default"/> defines STAMP Session-Sender and Session-Reflector test packets that can include one or more optional TLVs. In this document, the TLV Type (value 9 for IPv4 and IPv6) is defined for the Destination Node Address TLV
    for the STAMP test packet <xref target="RFC8972" format="default"/>. The formats of 
      the Destination Node Address TLVs are shown in <xref target="ure-node-address-tlv-format"/>:</t>

      <figure anchor="ure-node-address-tlv-format">
        <name>Destination Node Address TLV Formats</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|    Type=9     |         Length=4              |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                         IPv4 Address                          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|    Type=9     |         Length=16             |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 |                         IPv6 Address                          |
 |                                                               |
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
      </figure>
      <t> The TLV fields are defined as follows:</t>
      <dl spacing="normal">
      <dt> STAMP TLV Flags:</dt><dd> The STAMP TLV Flags follow the procedures described in <xref target="RFC8972" format="default"/> and this document.</dd>
      <dt> Type:</dt><dd> Type (value 9) for the IPv4 Destination Node Address TLV or IPv6 Destination Node Address TLV.</dd>
      <dt> Length:</dt><dd> A 2-octet field equal to the length of the Address field in octets. The length is 4 octets for an IPv4 address and 16 octets for an IPv6 address.</dd>
      </dl>
      <t>
   The Destination Node Address TLV indicates an address of the intended
   Session-Reflector node of the test packet.  If the received
   Destination Node Address is one of the addresses of the
   Session-Reflector, it <bcp14>SHOULD</bcp14> be used as the Source Address in the IP
   header of the reply test packet. 
   If the Destination Node Address TLV is sent, the SSID <bcp14>MUST</bcp14> also be sent. </t> 
	      
      <t>A Session-Reflector that recognizes this TLV <bcp14>MUST</bcp14> set the U flag <xref target="RFC8972" format="default"/> in the reply test packet to 1 if the Session-Reflector 
      determined that it is not the intended destination as identified in the Destination
      Node Address TLV. In this case, the Session-Reflector does not use the received Destination Node Address 
       as the Source Address in the IP header of the reply test packet.
      Otherwise, the Session-Reflector <bcp14>MUST</bcp14> set the U flag in the Destination Node Address TLV in the 
      reply test packet to 0.</t>
    </section>

    <section anchor="sect-5" numbered="true" toc="default">
      <name>Return Path TLV</name>
      <t>
   For end-to-end SR paths, the Session-Reflector may need to transmit the reply test 
   packet on a specific Return Path.  The Session-Sender
   can request this in the test packet to the Session-Reflector using a Return Path TLV. 
   With this TLV carried in the Session-Sender test packet,
   signaling and maintaining dynamic SR network state for the
   STAMP sessions on the Session-Reflector are avoided.</t>
   <t>There are two modes defined for the behaviors on the Session-Reflector in <xref target="RFC8762" sectionFormat="of" section="4"/>: Stateless and Stateful.
   A Stateful Session-Reflector requires configuration that must match all Session-Sender parameters, including the Source Address, Destination Address, Source UDP Port, Destination UDP Port, and possibly SSID (assuming the SSID is configurable and not auto-generated). In this case, a local policy can be used to direct the test packet by creating additional states for the STAMP sessions on the Session-Reflector. In the case of promiscuous operation, the Stateless Session-Reflector will require an indication of how to return the test packet on a specific path, for example, for measurement in an ECMP environment. </t>

      <t>For links, the Session-Reflector may need to transmit the reply test
   packet on the same incoming link in the reverse direction. 
   The Session-Sender can request this in the test packet 
   to the Session-Reflector using a Return Path TLV.</t>

      <t><xref target="RFC8972" format="default"/> defines STAMP test packets that
   can include one or more optional TLVs.  In this document, the TLV Type (value 10) is
   defined for the Return Path TLV that carries the Return Path for the Session-Sender 
   test packet. The format of the Return Path TLV is shown in <xref target="ure-return-path-tlv"/>:</t>
   <figure anchor="ure-return-path-tlv">
        <name>Return Path TLV Format</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|    Type=10    |         Length                |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                   Return Path Sub-TLVs                        |
 .                                                               .
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
      </figure>

      <t> The TLV fields are defined as follows:</t>
      <dl spacing="normal">
      <dt> STAMP TLV Flags:</dt><dd> The STAMP TLV Flags follow the procedures described in <xref target="RFC8972" format="default"/> and this document.</dd>
      <dt> Type:</dt><dd> Type (value 10) for the Return Path TLV.</dd>
      <dt> Length:</dt><dd> A 2-octet field equal to the length of the Return Path Sub-TLVs field in octets.</dd>
      <dt> Return Path Sub-TLVs:</dt><dd>As defined in <xref target="sect-5.1"/>.</dd>
      </dl>

      <t>
   A Session-Sender <bcp14>MUST NOT</bcp14> insert more than one Return Path TLV in the
   STAMP test packet.  A Session-Reflector that supports this TLV <bcp14>MUST</bcp14>
   only process the first Return Path TLV in the test packet and ignore
   other Return Path TLVs if present.  A Session-Reflector that supports
   this TLV <bcp14>MUST</bcp14> reply using the Return Path received in the
   Session-Sender test packet, if no error was encountered while processing the TLV.
      </t>
  
   <t>A Session-Reflector that recognizes this TLV <bcp14>MUST</bcp14> set the U flag <xref target="RFC8972" format="default"/> in the reply test packet to 1 if the Session-Reflector 
   determined that it cannot use the Return Path in the test packet to transmit the reply test packet.
   Otherwise, the Session-Reflector <bcp14>MUST</bcp14> set the U flag in the
   reply test packet to 0.</t>

   <section anchor="sect-5.1" numbered="true" toc="default">
        <name>Return Path Sub-TLVs</name>
        <t>The Return Path TLV contains one or more Sub-TLVs to carry 
   the information for the requested Return Path. 
   A Return Path Sub-TLV can carry a Return Path Control Code, 
   Return Path IP Address, or Return Path Segment List.</t>
        <t>The STAMP Sub-TLV Flags are set using the procedures described in <xref target="RFC8972" format="default"/>.</t>
        
        <t>A Return Path TLV <bcp14>MUST NOT</bcp14> contain more than one Control Code Sub-TLV, Return Address Sub-TLV, or Return Path Segment List Sub-TLV in a Session-Sender test packet.</t>
        <t>A Return Path TLV <bcp14>MUST NOT</bcp14> contain both a Control Code Sub-TLV and a Return Address or Return Path Segment List Sub-TLV in a Session-Sender test packet.</t>
        <t>A Return Path TLV <bcp14>MAY</bcp14> contain both a Return Address and a Return Path Segment List Sub-TLV in a Session-Sender test packet.</t>

        <section anchor="sect-4.1.1" numbered="true" toc="default">
          <name>Return Path Control Code Sub-TLV</name>
          <t>The format of the Control Code Sub-TLV in the Return Path TLV is shown in <xref target="ure-control-code-return-path-tlv"/>.</t>

          <figure anchor="ure-control-code-return-path-tlv">
            <name>Format of the Control Code Sub-TLV in the Return Path TLV</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|   Type=1      |         Length=4              |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                   Control Code Flags                          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
          </figure>
	  
      <t>The TLV fields are defined as follows:</t>
      <dl newline="false" spacing="normal">
	<dt>Type:</dt><dd>Type (value 1) for the Return Path Control Code. 
    The Session-Sender can request the Session-Reflector
    to transmit the reply test packet based on the flags defined in the Control Code Flags field.</dd>
      <dt>STAMP TLV Flags:</dt><dd> The STAMP TLV Flags follow the procedures described in <xref target="RFC8972" format="default"/> and this document.</dd>
      <dt>Length:</dt><dd> A 2-octet field equal to the length of the Control Code flags, which is 4 octets.</dd>
      <dt>Control Code Flags (32 bits):</dt><dd><t>Reply Request Flag at bit 31 (least significant bit) is defined as follows.</t>
      <dl newline="false" spacing="normal" indent="3">
      <dt> 0x0:</dt><dd> No Reply Requested</dd>
      <dt> 0x1:</dt><dd> Reply Requested on the Same Link</dd>
      </dl>
     </dd>
     </dl>
      <t> All other bits are reserved and must be transmitted as 0 and ignored by the receiver.</t>

          <t>When Control Code flag for Reply Request is set to 0x0 in the Session-Sender test packet, 
    the Session-Reflector does not
    transmit a reply test packet to the Session-Sender and terminates the
    STAMP test packet. Only the one-way measurement is applicable in this case.
    Optionally, the Session-Reflector may locally stream performance metrics
    via telemetry using the information from the received test packet.
    All other Return Path Sub-TLVs <bcp14>MUST</bcp14> be ignored in this case.</t>
          <t>When Control Code flag for Reply Request is set to 0x1 in the Session-Sender test packet, 
    the Session-Reflector transmits the reply test packet over the same incoming link 
    where the test packet is received in the reverse direction towards the Session-Sender.
    The link may be a physical interface, virtual link, LAG <xref target="IEEE802.1AX" format="default"/>, or LAG member. 
    All other Return Path Sub-TLVs <bcp14>MUST</bcp14> be ignored in this case.
    When using LAG member links, the STAMP extension for the Micro-Session ID TLV defined 
    in <xref target=" I-D.ietf-ippm-stamp-on-lag" format="default"/> can be used to identify the link. 
        </t>
        </section>
        <section anchor="sect-5.1.2" numbered="true" toc="default">
          <name>Return Address Sub-TLVs</name>
          <t>The STAMP reply test packet may be transmitted to the Session-Sender  
   to the specified Return Address in the Return Address Sub-TLV instead of transmitting to the Source Address in the Session-Sender test packet.</t>
   <t>The formats of the IPv4 and IPv6 Return Address Sub-TLVs in the Return Path TLV are shown in <xref target="ure-return-node-address-tlv-format"/>.</t>  

          <figure anchor="ure-return-node-address-tlv-format">
            <name>Formats of the Return Address Sub-TLVs in the Return Path TLV</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|     Type=2    |         Length=4              |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    Return IPv4 Address                        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|     Type=2    |         Length=16             |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               | 
 |                    Return IPv6 Address                        |
 |                                                               |
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
          </figure>
  
      <t> The TLV fields are defined as follows:</t>
       <dl newline="false" spacing="normal">
         <dt>Type:</dt><dd>Type (value 2) for the Return IPv4 Address or Return IPv6 Address.</dd>
       </dl>
   
      <t> The Return Address requests that the Session-Reflector reply test packet
      be sent to the specified address rather than to the Source Address in
      the Session-Sender test packet.</t>     

     <dl spacing="normal">  
      <dt> STAMP TLV Flags:</dt><dd> The STAMP TLV Flags follow the procedures described in <xref target="RFC8972" format="default"/> and this document.</dd>
      <dt> Length:</dt><dd> A 2-octet field equal to the length of the Return Address field in octets. 
      The length is 4 octets for an IPv4 address and 16 octets for an IPv6 address.</dd>
     </dl>

        </section>
        <section anchor="sect-5.1.3" numbered="true" toc="default">
          <name>Return Path Segment List Sub-TLVs</name>
          <t>The format of the Segment List Sub-TLVs in the Return Path TLV is shown in Figures <xref target="ure-sr-mpl-segment-list-sub-tlv-in-return-path-tlv" format="counter"/> and <xref target="ure-srv6segment-list-sub-tlv-in-return-path-tlv" format="counter"/>.
      The Segments carried in Segment List Sub-TLVs are described in <xref target="RFC8402" format="default"/>. 
      The segment entries <bcp14>MUST</bcp14> be in network order.</t> 

          <t>The Session-Sender <bcp14>MUST</bcp14> only insert one Return Path Segment List Sub-TLV
      in the test packet, and the Segment List <bcp14>MUST</bcp14> contain at least one Segment.  The Session-Reflector <bcp14>MUST</bcp14> only process
      the first Return Path Segment List Sub-TLV in the test packet and ignore other
      Return Path Segment List Sub-TLVs if present.</t>

      <t> The TLV fields are defined as follows:</t>
       <dl newline="false" spacing="normal">
	 <dt> The Return Path Segment List Sub-TLV can be one of the following Types:</dt>
	 <dd><t><br/></t>
          <dl indent="3" newline="false" spacing="normal">
            <dt>Type (value 3):</dt><dd> SR-MPLS Label Stack of the Return Path</dd>
            <dt>Type (value 4):</dt><dd> SRv6 Segment List of the Return Path</dd>
          </dl>
	 </dd>
      <dt> STAMP TLV Flags:</dt><dd> The STAMP TLV Flags follow the procedures described in <xref target="RFC8972" format="default"/> and this document.</dd>
      <dt> Length:</dt><dd> A 2-octet field equal to the length of the Segment List field in octets. The length <bcp14>MUST NOT</bcp14> be 0.</dd>
       </dl>

        <section anchor="sect-5.1.3.1" numbered="true" toc="default">
        <name>Return Path SR-MPLS Label Stack Sub-TLV</name>

          <figure anchor="ure-sr-mpl-segment-list-sub-tlv-in-return-path-tlv">
            <name>Format of the SR-MPLS Label Stack Sub-TLV in the Return Path TLV</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|     Type=3    |         Length                |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |      Segment(1)                       | TC  |S|      TTL      |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 .                                                               .
 .                                                               .
 .                                                               .
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |      Segment(n) (bottom of stack)     | TC  |S|      TTL      |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
          </figure>


     <t>The SR-MPLS Label Stack contains a list of 32-bit Label Stack Entries (LSEs) that includes a 20-bit label value, 
      an 8-bit Time-To-Live (TTL) value, a 3-bit Traffic Class (TC) value, and a 1-bit End-of-Stack (S) field. The length of the Sub-TLV modulo 4 <bcp14>MUST</bcp14> be 0.</t>

      <t>As an example, an SR-MPLS Label Stack Sub-TLV could carry only the Binding SID Label  
      <xref target="I-D.ietf-pce-binding-label-sid" format="default"/> of the Return SR-MPLS Policy.
      The Binding SID Label of the Return SR-MPLS Policy is local to the Session-Reflector.
      The mechanism to signal the Binding SID Label to the Session-Sender is outside the scope of this document.</t>

      <t>As another example, an SR-MPLS Label Stack Sub-TLV could include the Path Segment Identifier Label of the Return SR-MPLS Policy in the Segment List of the SR-MPLS Policy.</t>

        </section>

        <section anchor="sect-5.1.3.2" numbered="true" toc="default">
        <name>Return Path SRv6 Segment List Sub-TLV</name>

          <figure anchor="ure-srv6segment-list-sub-tlv-in-return-path-tlv">
            <name>Format of the SRv6 Segment List Sub-TLV in the Return Path TLV</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|     Type=4    |         Length                |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 |      Segment(1) (128-bit IPv6 Address)                        |
 |                                                               |
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 .                                                               .
 .                                                               .
 .                                                               .
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 |      Segment(n) (128-bit IPv6 Address) (bottom of stack)      |
 |                                                               |
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
          </figure>

      <t>The SRv6 Segment List contains a list of 128-bit IPv6 addresses representing the SRv6 SIDs. The length of the Sub-TLV modulo 16 <bcp14>MUST</bcp14> be 0.</t>

      <t>As an example, a Return Path SRv6 Segment List Sub-TLV could carry only the SRv6 Binding SID 
      <xref target="I-D.ietf-pce-binding-label-sid" format="default"/> of the Return SRv6 Policy.
      The SRv6 Binding SID of the Return SRv6 Policy is local to the Session-Reflector.
      The mechanism to signal the SRv6 Binding SID to the Session-Sender is outside the scope of this document.</t>

      <t>As another example, a Return Path SRv6 Segment List Sub-TLV could include the SRv6 Path Segment Identifier of the Return SRv6 Policy in the Segment List of the SRv6 Policy.</t>

        </section>
        </section>
      </section>
    </section>


    <section anchor="sect-6" numbered="true" toc="default">
      <name>Interoperability with TWAMP Light</name>
      <t>This document does not introduce any additional considerations for interoperability
         with the Two-Way Active Measurement Protocol (TWAMP) Light than those described in <xref target="RFC8762" sectionFormat="of" section="4.6"/>. </t>

      <t>As described in <xref target="RFC8762" format="default"/>, there are two possible 
         combinations for such an interoperability use case:</t>
     <ul spacing="normal">
      <li> STAMP Session-Sender with TWAMP Light Session-Reflector </li>
      <li> TWAMP Light Session-Sender with STAMP Session-Reflector </li>
     </ul>

      <t>If any of the STAMP extensions defined in this document are used by STAMP Session-Sender, 
         the TWAMP Light Session-Reflector will view them as the Packet Padding field.</t>

    </section>

    <section anchor="sect-7" numbered="true" toc="default">
      <name>Security Considerations</name>
       <t>The security considerations specified in <xref target="RFC8762" format="default"/>
   and <xref target="RFC8972" format="default"/> also apply to the extensions
   defined in this document.  Specifically, the authenticated mode and the
   message integrity protection using Hashed Message Authentication Code (HMAC), as defined in <xref target="RFC8762" sectionFormat="of" section="4.4"/>, also apply to the procedures described in this document.</t>

   <t>STAMP uses the well-known UDP port number that could become 
   a target of denial of service (DoS) or could
   be used to aid on-path attacks.
   Thus, the security considerations and measures to mitigate the 
   risk of the attack documented in <xref target="RFC8545" sectionFormat="of" section="6"/>
   equally apply to the STAMP extensions in this document.</t>

   <t>If desired, attacks can be mitigated by performing basic validation
   checks of the timestamp fields (such as T2 is later than T1 in the reference topology in <xref target="sect-2.3"/>) 
   in received reply test packets at the Session-Sender.  The minimal state
   associated with these protocols also limit the extent of measurement
   disruption that can be caused by a corrupt or invalid test packet to a
   single test cycle.</t>

   <t>
   The usage of STAMP extensions defined in this document is intended for deployment in a single network administrative domain.
   As such, the Session-Sender address, Session-Reflector address, and Return Path are provisioned by the operator for the STAMP session.
   It is assumed that the operator has 
   verified the integrity of the Return Path and identity of the far-end Session-Reflector.</t>

   <t>
   The STAMP extensions defined in this document may be used for
   potential address spoofing. For example, a Session-Sender
   may specify a Return Path IP Address that is different from the Session-Sender address.  
   The Session-Reflector <bcp14>MAY</bcp14> drop the Session-Sender test packet when it cannot
   determine whether the Return Path IP Address is local on the
   Session-Sender. To help the Session-Reflector to make that determination, the Return Path 
   IP Address may also be provisioned by the operator, for example, in an access control list.
      </t>
    </section>


    <section anchor="sect-8" numbered="true" toc="default">
      <name>IANA Considerations</name>
      <t>
   IANA has allocated a value for the Destination Address TLV Type and a value for the 
   Return Path TLV Type from the IETF Review TLV range in the "STAMP TLV Types" registry <xref target="RFC8972" format="default"/> as follows.
</t>

      <table anchor="iana-tlv-type-tbl" align="center">
        <name>STAMP TLV Types</name>
        <thead>
          <tr>
            <th align="left">Value</th>
            <th align="left">Description</th>
            <th align="left">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">9</td>
            <td align="left">Destination Node IPv4 or IPv6 Address</td>
            <td align="left">RFC 9503</td>
          </tr>
          <tr>
            <td align="left">10</td>
            <td align="left">Return Path</td>
            <td align="left">RFC 9503</td>
          </tr>
        </tbody>
      </table>
 

   <t>
   IANA has created the "Return Path Sub-TLV Types" registry.
   All code points in the range 1 through 175 in this registry shall be
   allocated according to the "IETF Review" procedure as specified in
   <xref target="RFC8126" format="default"/>.  Code points in the range 176 through 239 shall be allocated according to the "First Come First
   Served" procedure as specified in <xref target="RFC8126" format="default"/>. 
   Remaining code points shall be allocated according to <xref target="iana-return-path-tbl" format="default"/>:
      </t>
      <table anchor="iana-return-path-tbl" align="center">
        <name>Return Path Sub-TLV Types Registry</name>
        <thead>
          <tr>
            <th align="left">Range</th>
            <th align="left">Registration Procedures</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">1-175</td>
            <td align="left">IETF Review</td>
          </tr>
          <tr>
            <td align="left">176-239</td>
            <td align="left">First Come First Served</td>
          </tr>
          <tr>
            <td align="left">240-251</td>
            <td align="left">Experimental Use</td>
          </tr>
          <tr>
            <td align="left">252-254</td>
            <td align="left">Private Use</td>
          </tr>
        </tbody>
      </table>
      <t>
   IANA has allocated values for the following Sub-TLV Types in the "Return Path Sub-TLV Types" registry.</t>
      <table anchor="iana-return-path-reg-types" align="center">
        <name>Return Path Sub-TLV Types</name>
        <thead>
          <tr>
            <th align="left">Value</th>
            <th align="left">Description</th>
            <th align="left">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">0</td>
            <td align="left">Reserved</td>
            <td align="left">RFC 9503</td>
          </tr>
          <tr>
            <td align="left">1</td>
            <td align="left">Return Path Control Code</td>
            <td align="left">RFC 9503</td>
          </tr>
          <tr>
            <td align="left">2</td>
            <td align="left">Return IPv4 or IPv6 Address</td>
            <td align="left">RFC 9503</td>
          </tr>
          <tr>
            <td align="left">3</td>
            <td align="left">SR-MPLS Label Stack of the Return Path</td>
            <td align="left">RFC 9503</td>
          </tr>
          <tr>
            <td align="left">4</td>
            <td align="left">SRv6 Segment List of the Return Path</td>
            <td align="left">RFC 9503</td>
          </tr>
          <tr>
            <td align="left">255</td>
            <td align="left">Reserved</td>
            <td align="left">RFC 9503</td>
          </tr>
        </tbody>
      </table>


   <t>
   IANA has created the "Return Path Control Code Flags" registry for Return Path Control Code Sub-TLVs.
   All code points in the bit position 31 (counting from bit 31 as the least significant bit) through 12 in this registry shall be
   allocated according to the "IETF Review" procedure as specified in
   <xref target="RFC8126" format="default"/>.  Code points in the bit position 11 through 8 shall be allocated according to the "First Come First
   Served" procedure as specified in <xref target="RFC8126" format="default"/>. 
   Remaining code points shall be allocated according to <xref target="iana-return-path-cc-tbl" format="default"/>:
      </t>
      <table anchor="iana-return-path-cc-tbl" align="center">
        <name>Return Path Control Code Flags Registry</name>
        <thead>
          <tr>
            <th align="left">Range</th>
            <th align="left">Registration Procedures</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">31-12</td>
            <td align="left">IETF Review</td>
          </tr>
          <tr>
            <td align="left">11-8</td>
            <td align="left">First Come First Served</td>
          </tr>
          <tr>
            <td align="left">7-4</td>
            <td align="left">Experimental Use</td>
          </tr>
          <tr>
            <td align="left">3-0</td>
            <td align="left">Private Use</td>
          </tr>
        </tbody>
      </table>
      <t>
   IANA has allocated a value in the "Return Path Control Code Flags" registry as follows.</t>
      <table anchor="iana-return-path-cc-reg-types" align="center">
        <name>Return Path Control Code Flags</name>
        <thead>
          <tr>
            <th align="left">Value</th>
            <th align="left">Description</th>
            <th align="left">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">31</td>
            <td align="left">Reply Request</td>
            <td align="left">RFC 9503</td>
          </tr>
        </tbody>
      </table>
    </section>
  </middle>
  <back>

<displayreference target="I-D.ietf-pce-binding-label-sid" to="PCE-BINDING-LABEL-SID"/>
<displayreference target="I-D.ietf-ippm-stamp-yang" to="IPPM-STAMP-YANG"/>
<displayreference target="I-D.ietf-ippm-stamp-on-lag" to="STAMP-ON-LAG"/>

    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>

	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8762.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8972.xml"/>

      </references>
      <references>
        <name>Informative References</name>

	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8402.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8126.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8545.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9256.xml"/>

<!-- [I-D.ietf-pce-binding-label-sid] in MISSREF state as of 10/30/23; entered the long way to capture the editor role -->
<reference anchor="I-D.ietf-pce-binding-label-sid" target="https://datatracker.ietf.org/doc/html/draft-ietf-pce-binding-label-sid-16">
  <front>
    <title>Carrying Binding Label/Segment Identifier (SID) in PCE-based Networks.</title>
    <author fullname="Siva Sivabalan" initials="S." surname="Sivabalan">
      <organization>Ciena Corporation</organization>
    </author>
    <author fullname="Clarence Filsfils" initials="C." surname="Filsfils">
      <organization>Cisco Systems, Inc.</organization>
    </author>
    <author fullname="Jeff Tantsura" initials="J." surname="Tantsura">
      <organization>Nvidia</organization>
    </author>
    <author fullname="Stefano Previdi" initials="S." surname="Previdi">
      <organization>Huawei Technologies</organization>
    </author>
    <author fullname="Cheng Li" initials="C." surname="Li" role="editor">
      <organization>Huawei Technologies</organization>
    </author>
    <date day="27" month="March" year="2023"/>
  </front>
  <seriesInfo name="Internet-Draft" value="draft-ietf-pce-binding-label-sid-16"/>
</reference>


<!-- [I-D.ietf-ippm-stamp-yang] Expired as of 10/30/23 -->
<xi:include href="https://datatracker.ietf.org/doc/bibxml3/reference.I-D.ietf-ippm-stamp-yang.xml"/>

<!-- [I-D.ietf-ippm-stamp-on-lag] In last call as of 10/30/23. Added the long
way to get correct author name-->
<reference anchor="I-D.ietf-ippm-stamp-on-lag" target="https://datatracker.ietf.org/doc/html/draft-ietf-ippm-stamp-on-lag-05">
  <front>
    <title>Simple Two-Way Active Measurement Protocol Extensions for Performance Measurement on LAG</title>
    <author fullname="Zhenqiang Li" initials="Z." surname="Li">
      <organization>China Mobile</organization>
    </author>
    <author fullname="Tianran Zhou" initials="T." surname="Zhou">
      <organization>Huawei</organization>
    </author>
    <author fullname="Guo Jun" initials="J." surname="Guo">
      <organization>ZTE Corp.</organization>
    </author>
    <author fullname="Greg Mirsky" initials="G." surname="Mirsky">
      <organization>Ericsson</organization>
    </author>
    <author fullname="Rakesh Gandhi" initials="R." surname="Gandhi">
      <organization>Cisco</organization>
    </author>
    <date day="17" month="October" year="2023"/>
  </front>
  <seriesInfo name="Internet-Draft" value="draft-ietf-ippm-stamp-on-lag-05"/>
</reference>
        <reference anchor="IEEE802.1AX">
          <front>
            <title>IEEE Standard for Local and metropolitan area networks -- Link Aggregation</title>
            <author>
              <organization>IEEE
              </organization>
            </author>
            <date month="December" year="2014"/>
          </front>
	  <seriesInfo name="IEEE" value="Std 802.1AX-2014"/>
	 <seriesInfo name="DOI" value="10.1109/IEEESTD.2014.7055197"/>
        </reference>
      </references>
      </references>
      <section anchor="app-A" toc="default">
		  <name>Destination Node Address TLV Use-Case Example</name>
     <t>STAMP test packets can be  
    encapsulated with 1) an SR-MPLS Label Stack and IPv4 header containing 
    an IPv4 Destination Address from the 127/8 range or 2) an outer IPv6 header and a Segment Routing 
    Header (SRH) with an inner IPv6 header containing an IPv6 Destination Address from the ::1/128 range.</t> 

    <t>In an ECMP environment, the hashing function in forwarding may decide the outgoing
    path using the Source Address, Destination Address, UDP ports, IPv6 flow-label, etc. from the packet. 
    Hence, for IPv4, for example, different values of an IPv4 Destination 
    Address from the 127/8 range may be used in the IPv4 header of the STAMP test packets to measure different ECMP paths.
    For IPv6, for example, different values of flow-label may be used in the IPv6 header of the STAMP test packets to measure different ECMP paths.</t>

    <t>
    In those cases, the STAMP test packets may reach a node that is not the Session-Reflector 
    for this STAMP session in an error condition, and this unintended node may transmit a reply 
    test packet that can result in the reporting of invalid measurement metrics. The intended Session-Reflector address
    can be carried in the Destination Node Address TLV to help detect this error. 
    </t>
    </section>

    <section numbered="false" anchor="acknowledgments" toc="default">
      <name>Acknowledgments</name>
      <t>
   The authors would like to thank Thierry Couture for the discussions
   on the use cases for Performance Measurement in Segment Routing.  The authors
   would also like to thank <contact fullname="Greg Mirsky"/>, <contact fullname="Mike Koldychev"/>, <contact fullname="Gyan Mishra"/>, <contact fullname="Tianran Zhou"/>, 
   <contact fullname="Al Morton"/>, <contact fullname="Reshad Rahman"/>, <contact fullname="Zhenqiang Li"/>, <contact fullname="Frank Brockners"/>, <contact fullname="Henrik Nydell"/>,  
   and <contact fullname="Cheng Li"/> for providing comments and suggestions. Thank you to <contact fullname="Joel Halpern"/> for the
   Gen-ART review, <contact fullname="Martin Duke"/> for the AD review, and <contact fullname="Kathleen Moriarty"/> for the Security review. 
   The authors would also like to thank <contact fullname="Robert Wilton"/>, <contact fullname="Ã‰ric Vyncke"/>, <contact fullname="Paul Wouters"/>, <contact fullname="John Scudder"/>, <contact fullname="Roman Danyliw"/>, <contact fullname="Lars Eggert"/>, <contact fullname="Erik Kline"/>, <contact fullname="Warren Kumari"/>, and <contact fullname="Jim Guichard"/> for the IESG review.</t>
    </section>

    <section numbered="false" anchor="contributors" toc="default">
      <name>Contributors</name>
   <t>The following person has contributed substantially to this document:</t>

  <contact fullname="Daniel Voyer">
        <organization showOnFrontPage="true">Bell Canada</organization>
        <address>
          <email> daniel.voyer@bell.ca</email>
        </address>
  </contact>
   </section>
   
  </back>
</rfc>
