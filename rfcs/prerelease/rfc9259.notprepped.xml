<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
]>

<rfc xmlns:xi="http://www.w3.org/2001/XInclude" docName="draft-ietf-6man-spring-srv6-oam-13" number="9259" ipr="trust200902" obsoletes="" updates="" submissionType="IETF" category="std" consensus="true" xml:lang="en" tocInclude="true" tocDepth="3" symRefs="true" sortRefs="true" version="3">


  <!-- xml2rfc v2v3 conversion 3.12.2 -->
  <front>
    <title abbrev="SRv6 OAM">Operations, Administration, and Maintenance (OAM) in Segment Routing over IPv6 (SRv6)</title>
    <seriesInfo name="RFC" value="9259"/>
    <author fullname="Zafar Ali" initials="Z" surname="Ali">
      <organization>Cisco Systems</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <code/>
          <country/>
        </postal>
        <email>zali@cisco.com</email>
      </address>
    </author>
    <author fullname="Clarence Filsfils" initials="C." surname="Filsfils">
      <organization>Cisco Systems</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <code/>
          <country/>
        </postal>
        <email>cfilsfil@cisco.com</email>
      </address>
    </author>
    <author fullname="Satoru Matsushima" initials="S" surname="Matsushima">
      <organization>Softbank</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <code/>
          <country/>
        </postal>
        <email>satoru.matsushima@g.softbank.co.jp</email>
      </address>
    </author>
    <author fullname="Daniel Voyer" initials="D" surname="Voyer">
      <organization>Bell Canada</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <code/>
          <country/>
        </postal>
        <email>daniel.voyer@bell.ca</email>
      </address>
    </author>
    <author fullname="Mach(Guoyi) Chen" initials="M" surname="Chen">
      <organization>Huawei</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <code/>
          <country/>
        </postal>
        <email>mach.chen@huawei.com</email>
      </address>
    </author>
    <date year="2022" month="June" />
    <area>int</area>
    <workgroup>6man</workgroup>
    <keyword>SRv6</keyword>
    <keyword>Segment Routing</keyword>
    <keyword>OAM</keyword>
    <abstract>
      <t>This document describes how the existing IPv6 mechanisms for ping 
      and traceroute can be used in a Segment Routing over IPv6 (SRv6) network. 
      The document also specifies the OAM flag (O-flag) in the Segment Routing Header (SRH) 
      for performing controllable and predictable flow sampling from segment endpoints. 
      In addition, the document describes how a centralized monitoring system performs a 
      path continuity check between any nodes within an SRv6 domain. 
      </t>
    </abstract>
  </front>
  <middle>
    <section numbered="true" toc="default">
      <name>Introduction</name>
      <t> 
   As Segment Routing over IPv6 (SRv6) <xref target="RFC8402" format="default"/> 
   simply adds a new type
   of Routing Extension Header, existing IPv6 OAM mechanisms can be used
   in an SRv6 network.  This document describes how the existing 
   IPv6 mechanisms for ping and traceroute can be used in an SRv6 network.  
   This includes illustrations of pinging an SRv6 Segment Identifier (SID) to
   verify that the SID is reachable and is locally programmed at the target node.
   This also includes illustrations for
   tracerouting to an SRv6 SID for hop-by-hop
   fault localization as well as path tracing to a SID.  
   
      </t>
      <t> 
   This document also introduces enhancements for the OAM mechanism for SRv6
   networks that allow controllable and predictable flow sampling from segment
   endpoints using, e.g., the IP Flow Information Export (IPFIX) protocol
   <xref target="RFC7011" format="default"/>. Specifically, the document
   specifies the OAM flag (O-flag) in the SRH as a marking bit in the user
   packets to trigger telemetry data collection and export at the segment
   endpoints.
      </t>
      <t> 
   This document also outlines how the centralized OAM technique in 
   <xref target="RFC8403" format="default"/> can be extended for SRv6 to perform a path continuity check between 
   any nodes within an SRv6 domain. 
   Specifically, the document illustrates how a centralized monitoring system can 
   monitor arbitrary SRv6 paths by   
   creating loopback probes that
   originate and terminate at the centralized monitoring system. 

      </t>
      <section numbered="true" toc="default">
        <name>Requirements Language</name>
        <t>
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL
    NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
    described in BCP&nbsp;14 <xref target="RFC2119"/> <xref target="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
        </t>

      </section>
      <section numbered="true" toc="default">
        <name>Abbreviations</name>
        <t> The following abbreviations are used in this document: 
        </t>
        <dl newline="false" spacing="normal">
          <dt>SID:</dt>
          <dd>Segment Identifier
            </dd>
          <dt>SL:</dt>
          <dd>Segments Left
           </dd>
          <dt>SR:</dt>
          <dd>Segment Routing
           </dd>
          <dt>SRH:</dt>
          <dd>Segment Routing Header <xref target="RFC8754" format="default"/>
           </dd>
          <dt>SRv6:</dt>
          <dd>Segment Routing over IPv6 <xref target="RFC8402" format="default"/>
           </dd>
          <dt>PSP:</dt>
          <dd>Penultimate Segment Pop <xref target="RFC8986" format="default"/>
           </dd>
          <dt>USP:</dt>
          <dd>Ultimate Segment Pop <xref target="RFC8986" format="default"/>
           </dd>
          <dt>ICMPv6:</dt>
          <dd>Internet Control Message Protocol for the Internet Protocol version 6 <xref target="RFC4443" format="default"/>
           </dd>
          <dt>IS-IS:</dt>
          <dd>Intermediate System to Intermediate System
           </dd>
          <dt>OSPF:</dt>
          <dd>Open Shortest Path First <xref target="RFC2328" format="default"/>
          </dd>
          <dt>IGP:</dt>
          <dd>Interior Gateway Protocol (e.g., OSPF and IS-IS)
           </dd>
          <dt>BGP-LS:</dt>
          <dd>Border Gateway Protocol - Link State <xref target="RFC8571" format="default"/>
          </dd>
        </dl>
      </section>
      <section numbered="true" toc="default">
        <name>Terminology and Reference Topology</name>
        <t>The terminology and 
     simple topology in this section are used for illustration throughout the document. </t>
     <figure anchor="ref-top">
       <name>Reference Topology</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
+--------------------------| N100 |---------------------------------+
|                                                                   |
|  ====== link1====== link3------ link5====== link9------   ======  |
   ||N1||------||N2||------| N3 |------||N4||------| N5 |---||N7||
   ||  ||------||  ||------|    |------||  ||------|    |---||  ||
   ====== link2====== link4------ link6======link10------   ======
      |            |                      |                   |
   ---+--          |       ------         |                 --+---
   |CE1 |          +-------| N6 |---------+                 |CE2 |
   ------            link7 |    | link8                     ------        
                           ------                          
]]></artwork>
     </figure>
     <t> In the reference topology: 
        </t>
        <ul spacing="normal">
          <li> Node j has an IPv6 loopback address 2001:db8:L:j::/128.
           </li>
          <li> Nodes N1, N2, N4, and N7 are SRv6-capable nodes.
            </li>
          <li> Nodes N3, N5, and N6 are IPv6 nodes that are not SRv6-capable nodes. 
            Such nodes are referred to as "non-SRv6-capable nodes".
           </li>
          <li> CE1 and CE2 are Customer Edge devices of any data plane 
			capability (e.g., IPv4, IPv6, and L2). 
           </li>
          <li> A SID at node j with locator block 2001:db8:K::/48 and function U is represented
     by 2001:db8:K:j:U::.
           </li>
          <li> Node N100 is a controller.
           </li>

           <li> The IPv6 address of the nth link between nodes i and j at the i side
     is represented as 2001:db8:i:j:in::. For example, in <xref target="ref-top"/>, the IPv6 address of link6
     (the second link between nodes N3 and N4) at node N3 is
     2001:db8:3:4:32::. Similarly, the IPv6 address of link5 (the first
     link between nodes N3 and N4) at node N3 is 2001:db8:3:4:31::. 
           </li>
          <li> 2001:db8:K:j:Xin:: is explicitly allocated as the End.X SID 
            at node j 
     towards neighbor node i via the nth link between nodes i and j. 
     For example, 2001:db8:K:2:X31:: represents End.X at node N2 towards node N3 via link3 (the first 
     link between nodes N2 and N3). Similarly, 2001:db8:K:4:X52:: represents the End.X at 
     node N4 towards node N5 via link10 (the second 
     link between nodes N4 and N5). Please refer to <xref target="RFC8986" format="default"/> for 
     a description of End.X SID. 
           </li>
          <li> A SID list is represented as &lt;S1, S2, S3&gt;, where 
            S1 is the first SID
   to visit, S2 is the second SID to visit, and S3 is the last SID to
   visit along the SR path.
           </li>
          <li>
            <t> (SA,DA) (S3, S2, S1; SL)(payload) represents an IPv6 packet with:

            </t>
            <ul spacing="normal">
              <li> IPv6 header with source address SA, destination address DA, and
     SRH as the next header
            </li>
              <li><t>SRH with SID list &lt;S1, S2, S3&gt; with SegmentsLeft = SL</t>

              <t> Note the difference between the &lt; &gt; and () symbols: 
            &lt;S1, S2, S3&gt;
     represents a SID list where S1 is the first SID and S3 is the last
     SID to traverse.  (S3, S2, S1; SL) represents the same SID list but
     encoded in the SRH format where the rightmost SID in the SRH is the
     first SID and the leftmost SID in the SRH is the last SID.  When
     referring to an SR Policy in a high-level use case, it is simpler
     to use the &lt;S1, S2, S3&gt; notation.  When referring to an
     illustration of the detailed packet behavior, the (S3, S2, S1; SL)
     notation is more convenient.</t>
           </li>
              <li> (payload) represents the payload of the packet.
           </li>
            </ul>
          </li>
        </ul>
      </section>
    </section>
    <!--end: Introduction -->
	    
    <section numbered="true" toc="default">
      <name>OAM Mechanisms</name>
      <t>This section defines OAM enhancements for SRv6 networks. 
      </t>
      <section numbered="true" toc="default">
        <name>OAM Flag in the Segment Routing Header</name>
        <t><xref target="RFC8754" format="default"/> describes the Segment
     Routing Header (SRH) and how SR-capable nodes use it. The SRH
     contains an 8-bit Flags field. </t>
        <t> This document defines the following bit in the 
     SRH Flags field to carry the O-flag: </t>
<artwork name="" type="" align="left" alt=""><![CDATA[
               0 1 2 3 4 5 6 7
              +-+-+-+-+-+-+-+-+
              |   |O|         |
              +-+-+-+-+-+-+-+-+
]]></artwork>
        <t> Where: 
      
        </t>
        <dl newline="false" spacing="normal">
          <dt>O-flag:</dt>
          <dd>OAM flag in the SRH Flags field defined in <xref target="RFC8754" format="default"/>. 
            </dd>
        </dl>
        <section anchor="oflag-proc" numbered="true" toc="default">
          <name>OAM Flag Processing</name>
          <t> The O-flag in the SRH is used as a marking bit in user packets to trigger 
	telemetry data collection and export at the segment endpoints. 	
          </t>
          <t> An SR domain ingress edge node encapsulates packets traversing the SR
    domain as defined in <xref target="RFC8754" format="default"/>. The SR domain ingress edge node
    <bcp14>MAY</bcp14> use the O-flag in the SRH for marking the packet to trigger 
	the telemetry data collection and export at the segment endpoints. 
	Based on local configuration, the SR domain ingress edge node 
	may implement a classification and sampling mechanism to mark a packet with the O-flag in the SRH. 
	Specification of the classification and sampling method is outside the scope of this
    document. 
          </t>
          <t> 
	This document does not specify the data elements that need to be exported 
	and the associated configurations. 
	Similarly, this document does not define any formats for exporting the data
	elements. 
	Nonetheless, without the loss of generality, this document assumes that the
	IP Flow Information Export (IPFIX) protocol <xref target="RFC7011" format="default"/> is used for exporting 
	the traffic flow information from the network devices to a controller for 
	monitoring and analytics.  	
	Similarly, without the loss of generality, this document assumes that requested information 
	elements are configured
    by the management plane through data set templates (e.g., as in IPFIX
    <xref target="RFC7012" format="default"/>). 
          </t>
          <t>Implementation of the O-flag is <bcp14>OPTIONAL</bcp14>. If a node does not support the
     O-flag, then it simply ignores it upon reception.  If a node supports
     the O-flag, it can optionally advertise its potential via 
     control plane protocol(s). 
          </t>

	  <t>The following is appended to line S01 of the pseudocode
	  associated with the SID S (as defined in <xref target="RFC8754"
	  sectionFormat="of" section="4.3.1.1" format="default"/>) when N
	  receives a packet destined to S, S is a local SID, and the O-flag is
	  processed.
          </t>
<sourcecode type="pseudocode"><![CDATA[
   S01.1. IF the O-flag is set and local configuration permits 
          O-flag processing {
             a. Make a copy of the packet.  
             b. Send the copied packet, along with a timestamp, 
             to the OAM process for telemetry data collection 
             and export.      ;; Ref1
             }
   Ref1: To provide an accurate timestamp, an implementation should
   copy and record the timestamp as soon as possible during packet
   processing. Timestamp and any other metadata are not carried in
   the packet forwarded to the next hop.
]]></sourcecode>
          <t> Please note that the O-flag processing happens before execution of regular 
	processing of the local SID S. Specifically, line S01.1 of the pseudocode 
	specified in this document is inserted between lines S01 
    and S02 of the pseudocode defined in <xref target="RFC8754" sectionFormat="of" section="4.3.1.1" format="default"/>. 
          </t>
          <t>
      Based on the 
      requested information elements configured
      by the management plane through data set templates <xref target="RFC7012" format="default"/>, 
      the OAM process exports the requested information elements. 
   The information elements include parts of the packet header and/or parts of 
   the packet payload for flow identification.   
   The OAM process uses information elements defined in 
   IPFIX <xref target="RFC7011" format="default"/> and Packet Sampling (PSAMP) <xref target="RFC5476" format="default"/> for exporting the requested sections 
   of the mirrored packets. 
          </t>
          <t>   
    
    If the penultimate segment of a segment list is a PSP SID, 
    telemetry data from the ultimate segment cannot be requested. This is because, 
    when the penultimate segment is a PSP SID,
   the SRH is removed at the penultimate segment, and the O-flag is 
   not processed at the ultimate segment.
    
          </t>
          <t>         
      The processing node <bcp14>MUST</bcp14> 
      rate-limit the number of packets punted to the OAM process 
      to a configurable rate. 
      This is to avoid impacting the
      performance of the OAM and 
      telemetry collection processes. Failure to implement the rate 
      limit can lead to a denial-of-service attack, as detailed in <xref target="Security" format="default"/>.  
      
          </t>
          <t>
     The OAM process <bcp14>MUST NOT</bcp14> process the copy of the packet or respond 
      to any Upper-Layer header 
      (like ICMP, UDP, 
      etc.) payload to prevent multiple evaluations of the datagram. 
          </t>
          <t>
      The OAM process is expected to be located on the routing node processing the packet.
      Although the specification of the OAM process or the external controller
      operations are beyond the scope of this document, the OAM process <bcp14>SHOULD NOT</bcp14> be
      topologically distant from the routing node, as this is likely to create significant security
      and congestion issues.  
      How to correlate the data collected from different nodes at an
      external controller is also outside the scope of this document. 
      <xref target="app-illustrations" /> illustrates use of the O-flag for implementing 
      a hybrid OAM mechanism, where the "hybrid" classification      
      is based on <xref target="RFC7799" format="default"/>. 

          </t>
        </section>
        <!--end: O-flag Processing -->
    </section>
      <!--end: O-flag  -->

	<section numbered="true" toc="default">
        <name>OAM Operations</name>
        <t> IPv6 OAM operations can be performed for any SRv6 SID whose behavior
   allows Upper-Layer header processing for an applicable OAM payload
   (e.g., ICMP, UDP). 
</t>

<t> Ping to an SRv6 SID is used to verify  
   that the SID is reachable and is locally programmed at the target node.
   Traceroute to a SID is used for hop-by-hop
   fault localization as well as path tracing to a SID.  <xref target="app-illustrations" />
   illustrates the ICMPv6-based ping and UDP-based traceroute mechanisms
   for ping and traceroute to an SRv6 SID.  Although this document only
   illustrates ICMPv6-based ping and UDP-based traceroute to an SRv6 SID, the procedures are
   equally applicable to other OAM mechanisms that probe an SRv6 SID 
   (e.g., Bidirectional Forwarding Detection (BFD) <xref target="RFC5880" format="default"/>, 
Seamless BFD (S-BFD) <xref target="RFC7880" format="default"/>, and Simple Two-way Active Measurement Protocol (STAMP) probe message processing 
<xref target="I-D.ietf-spring-stamp-srpm" format="default"/>).  
Specifically, as
   long as local configuration allows the Upper-Layer header processing of
   the applicable OAM payload for SRv6 SIDs, the existing IPv6 OAM
   techniques can be used to target a probe to a (remote) SID.  
</t>
        <t> IPv6 OAM operations can be performed with the target SID in the IPv6 
destination address without an SRH or with an SRH where the target SID is the last segment. 
In general, OAM operations to a target SID may not exercise all of its 
processing depending on its behavior definition. 
For example, ping to an End.X SID <xref target="RFC8986" format="default"/>  
only validates the SID is locally programmed at the target node 
and does not validate switching to the 
correct outgoing interface.  
To exercise the behavior 
of a target SID, the OAM operation should construct the probe in a manner 
similar to a data packet that exercises the SID behavior, i.e. to include 
that SID as a transit SID in either an SRH or IPv6 DA of an outer IPv6 header 
or as appropriate 
based on the definition of the SID behavior. 

</t>
      </section>
      <!--end: Ping and Traceroute  -->

    </section>
    <!--end: OAM Mechanisms --> 
    
    <section anchor="Security" numbered="true" toc="default">
      <name>Security Considerations</name>
      <t>  <xref target="RFC8754" format="default"/> defines the notion of an SR domain and 
     use of the SRH within the SR domain.
     The use of OAM procedures described in this document is restricted to an SR domain. 
     For example, similar to SID manipulation, O-flag manipulation is not considered 
     a threat within the SR domain. 
     Procedures for securing an SR domain are defined in Sections <xref target="RFC8754" format="default" section="5.1" sectionFormat="bare"/> and <xref target="RFC8754" format="default" section="7" sectionFormat="bare"/> of 
     <xref target="RFC8754" format="default"/>. 
      </t>
      <t>
     As noted in <xref target="RFC8754" format="default" sectionFormat="of" section="7.1"/>, 
     compromised nodes within the SR domain may mount attacks. The O-flag 
     may be set by an attacking node attempting a denial-of-service attack on the 
     OAM process at the segment endpoint node. 
     An implementation correctly implementing 
     the rate limiting described in <xref target="oflag-proc" /> is not susceptible to that 
     denial-of-service attack. 
     Additionally, SRH flags are protected by the Hashed Message Authentication Code (HMAC) TLV, as 
     described in <xref target="RFC8754" format="default" sectionFormat="of" section="2.1.2.1"/>. 
     Once an HMAC is generated for a segment list with the O-flag set, 
     it can be used for an arbitrary amount of traffic using that 
     segment list with the O-flag set. 

      </t>
      <t>
 
     The security properties of the channel used to send exported packets marked 
     by the O-flag will depend on the specific OAM processes used.  
     An on-path attacker able to observe this OAM channel could conduct 
     traffic analysis, or potentially eavesdropping (depending on the OAM configuration), 
     of this telemetry for the entire SR domain from such a vantage point.
     
      </t>
      <t> 
     This document does not
     impose any additional security challenges to be considered beyond the
     security threats described in <xref target="RFC4884" format="default"/>, <xref target="RFC4443" format="default"/>, 
     <xref target="RFC0792" format="default"/>, 
    <xref target="RFC8754" format="default"/>, and <xref target="RFC8986" format="default"/>. 
      </t>
    </section>
    <!--end: Security Considerations-->    

    <section anchor="PRIVACY" numbered="true" toc="default">
      <name>Privacy Considerations</name>
      <t> The per-packet marking capabilities of the O-flag provide a granular 
     mechanism to collect telemetry.  When this collection is deployed by an operator 
     with the knowledge and consent of the users, it will enable a variety of diagnostics 
     and monitoring to support the OAM and security operations use cases needed for 
     resilient network operations.  However, this collection mechanism will also 
     provide an explicit protocol mechanism to operators for surveillance and 
     pervasive monitoring use cases done contrary to the user's consent.         
      </t>
    </section>
    <!--end: asd -->    

    <section anchor="IANA" numbered="true" toc="default">
      <name>IANA Considerations</name>
      <t>IANA has registered the following in the "Segment
	   Routing Header Flags" subregistry in the "Internet Protocol Version
	   6 (IPv6) Parameters" registry:
      </t>

<table anchor="iana-table"> 
  <name></name>   
  <thead>
    <tr>
      <th>Bit</th>   
      <th>Description</th>
      <th>Reference</th>
    </tr>
  </thead>
  <tbody>          
    <tr>
      <td>2</td>
      <td>O-flag</td>
      <td>RFC 9259</td>
    </tr>
  </tbody>
</table>

    </section>
    <!--end: IANA Considerations-->    

</middle>
  <back>

<displayreference target="I-D.ietf-spring-stamp-srpm" to="STAMP-SR"/>

    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8754.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8986.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>
      </references>
      <references>
        <name>Informative References</name>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.0792.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4443.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4884.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5837.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8403.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8402.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7011.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5476.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7012.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7799.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5880.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7880.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2328.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8571.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.9197.xml"/>


<!-- [I-D.gandhi-spring-stamp-srpm] Replaced by [I-D.ietf-spring-stamp-srpm] IESG state I-D Exists -->

<reference anchor="I-D.ietf-spring-stamp-srpm">
   <front>
      <title>Performance Measurement Using Simple TWAMP (STAMP) for Segment Routing Networks</title>
      <author fullname="Rakesh Gandhi" role="editor">
	 <organization>Cisco Systems, Inc.</organization>
      </author>
      <author fullname="Clarence Filsfils">
	 <organization>Cisco Systems, Inc.</organization>
      </author>
      <author fullname="Daniel Voyer">
	 <organization>Bell Canada</organization>
      </author>
      <author fullname="Mach(Guoyi) Chen">
	 <organization>Huawei</organization>
      </author>
      <author fullname="Bart Janssens">
	 <organization>Colt</organization>
      </author>
      <author fullname="Richard Foote">
	 <organization>Nokia</organization>
      </author>
      <date month="February" day="1" year="2022" />
   </front>
   <seriesInfo name="Internet-Draft" value="draft-ietf-spring-stamp-srpm-03" />
   <format type="TXT" target="https://www.ietf.org/archive/id/draft-ietf-spring-stamp-srpm-03.txt" />
</reference>

      </references>
    </references>
    <section anchor="app-illustrations" numbered="true" toc="default">
      <name>Illustrations</name>
      <t> This appendix shows how some of the
   existing IPv6 OAM mechanisms can be used in an SRv6 network. It also  
   illustrates an OAM mechanism for
   performing controllable and predictable flow sampling from segment
   endpoints. How the centralized OAM technique in 
   <xref target="RFC8403" format="default"/> can be extended for SRv6 is also described in this appendix. 
      </t>
      <section numbered="true" toc="default">
        <name>Ping in SRv6 Networks</name>
        <t> The existing mechanism to perform the reachability checks, 
     along the shortest path, continues to work without any modification. 
     Any IPv6 node (SRv6-capable or non-SRv6-capable) can initiate, transit, 
     and egress a ping packet. 

        </t>
        <t> The following subsections outline some additional use cases of ICMPv6 ping in
     SRv6 networks. 
        </t>
        <section numbered="true" toc="default">
          <name>Pinging an IPv6 Address via a Segment List</name>
          <t> If an SRv6-capable ingress node wants to ping an IPv6 address via an
     arbitrary segment list &lt;S1, S2, S3&gt;, it needs to initiate an ICMPv6
     ping with an SR header containing the SID list &lt;S1, S2, S3&gt;. This is
     illustrated using the topology in <xref target="ref-top"/>. The user issues a ping from node N1 to a
     loopback of node N5 via segment list &lt;2001:db8:K:2:X31::, 2001:db8:K:4:X52::&gt;. 
     The SID behavior used in the example is End.X,  
     as described in <xref target="RFC8986" format="default"/>, but the procedure is 
     equally applicable to any other (transit) SID type. 
          </t>
          <t><xref target="sample-ping"/> contains sample output for a ping request initiated at node
     N1 to a loopback address of node N5 via segment list &lt;2001:db8:K:2:X31::,
     2001:db8:K:4:X52::&gt;.
          </t>
	  <figure anchor="sample-ping">
	    <name>Sample Ping Output at an SRv6-Capable Node</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
    > ping 2001:db8:L:5:: via segment list 2001:db8:K:2:X31::, 
           2001:db8:K:4:X52::

    Sending 5, 100-byte ICMPv6 Echos to B5::, timeout is 2 seconds:
    !!!!!
    Success rate is 100 percent (5/5), round-trip min/avg/max = 0.625
    /0.749/0.931 ms
]]></artwork>
	  </figure>
          <t> All transit nodes process the echo request message like any other
     data packet carrying an SR header and hence do not require any change.
     Similarly, the egress node does not
     require any change to process the ICMPv6 echo request. For example,
     in the example in <xref target="sample-ping"/>:
     
          </t>
          <ul spacing="normal">
            <li>Node N1 initiates an ICMPv6 ping packet with the SRH as follows:
          (2001:db8:L:1::, 2001:db8:K:2:X31::)
          (2001:db8:L:5::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::, SL=2, 
          NH = ICMPv6)(ICMPv6 Echo Request). 
          </li>
            <li>Node N2, which is an SRv6-capable node, performs the standard
          SRH processing. Specifically, it executes the End.X behavior 
          indicated by the 2001:db8:K:2:X31:: SID and forwards the packet on link3 to node N3.</li>
            <li> Node N3, which is a non-SRv6-capable node, performs the standard
          IPv6 processing. Specifically, it forwards the echo request
          based on DA 2001:db8:K:4:X52:: in the IPv6 header. </li>
            <li> Node N4, which is an SRv6-capable node, performs the standard
          SRH processing. Specifically, it observes the End.X behavior
          (2001:db8:K:4:X52::) and forwards the packet on link10 towards node N5. 
          If 2001:db8:K:4:X52:: is a PSP SID,
          the penultimate node (node N4) does not, should not, and cannot differentiate 
          between the data packets and OAM probes. 
          Specifically, if 2001:db8:K:4:X52:: is a PSP SID, 
          node N4 executes the SID like any other data packet with DA = 2001:db8:K:4:X52:: 
          and removes the SRH. 
          </li>
            <li> The echo request packet at node N5 arrives as an IPv6 packet with or 
          without an SRH. If node N5 receives the packet with an SRH, it skips SRH processing (SL=0). 
          In either case, node N5 performs the
          standard ICMPv6 processing on the echo request and responds with the 
          echo reply message to node N1. The echo reply message is IP routed. 
          
          </li>
          </ul>
        </section>
        <!--end: Pinging an IPv6 address via a sid-list -->    
        
	<section numbered="true" toc="default">
          <name>Pinging a SID</name>
<t>
   The ping mechanism described above can also be used to perform SID
   reachability checks and to validate that the SID is locally programmed at
   the target node.
 	   This is explained in the
   following example. The example uses ping to an End SID, as described in <xref target="RFC8986" format="default"/>, 
   but the procedure is 
     equally applicable to ping any other SID behaviors. 
          </t>
          <t>  Consider the example where the user wants to ping a remote
          SID 2001:db8:K:4::, via 2001:db8:K:2:X31::, from node N1. 
          The ICMPv6 echo request is processed at the individual nodes
          along the path as follows: 
          
          </t>
          <ul spacing="normal">
            <li>Node N1 initiates an ICMPv6 ping packet with the SRH as follows:
          (2001:db8:L:1::, 2001:db8:K:2:X31::)
          (2001:db8:K:4::, 2001:db8:K:2:X31::; SL=1;
          NH=ICMPv6)(ICMPv6 Echo Request).  </li>
            <li>Node N2, which is an SRv6-capable node, performs the standard
          SRH processing. Specifically, it executes the End.X behavior 
          indicated by the 2001:db8:K:2:X31:: SID on the echo request packet. If 
          2001:db8:K:2:X31:: is a PSP SID, node N4 executes the SID like any	 		
      other data packet with DA = 2001:db8:K:2:X31:: and removes the	 		
      SRH. 
          </li>
            <li> Node N3, which is a non-SRv6-capable node, performs
          the standard IPv6 processing. Specifically, it forwards the
          echo request based on DA = 2001:db8:K:4:: in the IPv6 header.</li>
            <li>When node N4 receives the packet, it
          processes the target SID (2001:db8:K:4::). </li>
            <li> If the target SID (2001:db8:K:4::) is not locally instantiated  
          and does not represent a local interface,
          the packet is discarded </li>
            <li>
          If the target SID (2001:db8:K:4::) is locally instantiated or 
          represents a local interface, the node processes 
          the Upper-Layer header. 
          As part of the Upper-Layer header processing, node N4 responds
          to the ICMPv6 echo request message with an
          echo reply message. The echo reply message is IP routed. 
          
          </li>
          </ul>
        </section>
        <!--end: SID Ping -->    
     	    
    </section>
      <!--end: Ping-->    	

	<section numbered="true" toc="default">
        <name>Traceroute in SRv6 Networks</name>
        <t>  The existing traceroute
     mechanisms, along the shortest path, continue to work without any modification. 
     Any IPv6 node (SRv6-capable or a non-SRv6-capable) can initiate, transit, 
     and egress a traceroute probe. 

        </t>
        <t> 
     The following subsections outline some additional use cases of traceroute
     in SRv6 networks. 
        </t>
        <section numbered="true" toc="default">
          <name>Traceroute to an IPv6 Address via a Segment List</name>
          <t>  If an SRv6-capable ingress node wants to traceroute to an IPv6 address
     via an arbitrary segment list &lt;S1, S2, S3&gt;, it needs to initiate
     a traceroute probe with an SR header containing the SID list 
     &lt;S1, S2, S3&gt;. The user issues a traceroute
     from node N1 to a loopback of node N5 via segment list 
     &lt;2001:db8:K:2:X31::, 2001:db8:K:4:X52::&gt;. 
     The SID behavior used in the example is End.X, as described in 
      <xref target="RFC8986" format="default"/>, 
 	   but the procedure is equally applicable to any other (transit) SID	
 	   type.    
     
     <xref target="sample-traceroute"/> contains sample output for the traceroute
     request. 
          </t>
	  <figure anchor="sample-traceroute">
	    <name>Sample Traceroute Output at an SRv6-Capable Node</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
> traceroute 2001:db8:L:5:: via segment list 2001:db8:K:2:X31::, 
             2001:db8:K:4:X52::

Tracing the route to 2001:db8:L:5::
1  2001:db8:2:1:21:: 0.512 msec 0.425 msec 0.374 msec
   DA: 2001:db8:K:2:X31::, 
   SRH:(2001:db8:L:5::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::, SL=2)
2  2001:db8:3:2:31:: 0.721 msec 0.810 msec 0.795 msec
   DA: 2001:db8:K:4:X52::, 
   SRH:(2001:db8:L:5::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::, SL=1)
3  2001:db8:4:3::41:: 0.921 msec 0.816 msec 0.759 msec
   DA: 2001:db8:K:4:X52::, 
   SRH:(2001:db8:L:5::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::, SL=1)
4  2001:db8:5:4::52:: 0.879 msec 0.916 msec 1.024 msec
   DA: 2001:db8:L:5::
]]></artwork>
	  </figure>
          <t>  In the sample traceroute output, the information displayed at each hop 
	is obtained using the contents of the "Time Exceeded" or 
	"Destination Unreachable" ICMPv6 responses. These ICMPv6 responses 
	are IP routed. 
	
          </t>
          <t> In the sample traceroute output, the information for link3 is 
     returned by node N3, which is a
     non-SRv6-capable node. Nonetheless, the ingress node is able to display
     SR header contents as the packet travels through the non-SRv6-capable node. 
     This is because the "Time Exceeded" ICMPv6 message can
     contain as much of the invoking packet as possible without the 
     ICMPv6 packet exceeding the minimum IPv6 MTU <xref target="RFC4443" format="default"/>. The SR
     header is included in these ICMPv6 messages initiated by the
     non-SRv6-capable transit nodes that are not running SRv6 software.
     Specifically, a node generating an ICMPv6 message containing a copy of
     the invoking packet does not need to understand the extension
     header(s) in the invoking packet.
          </t>
          <t>  The segment list information returned for the first hop is returned by node N2,
     which is an SRv6-capable node. Just like for the second hop, the ingress node
     is able to display SR header contents for the first hop.
          </t>
          <t>  There is no difference in processing of the traceroute probe at an
     SRv6-capable and a non-SRv6-capable node. Similarly, both SRv6-capable and 
     non-SRv6-capable nodes may use the address of the interface on
     which probe was received as the source address in the ICMPv6
     response. ICMPv6 extensions defined in <xref target="RFC5837" format="default"/> can be used to 
     display information about the IP interface through which the
     datagram would have been forwarded had it been forwardable, the
     IP next hop to which the datagram would have been forwarded, the IP
     interface upon which the datagram arrived, and the sub-IP component of an
     IP interface upon which the datagram arrived. 
          </t>

	  <t>  The IP address of the interface on which the traceroute probe was received
     is useful. This information can also be used to verify if SIDs
     2001:db8:K:2:X31:: and 2001:db8:K:4:X52:: are executed correctly by nodes N2 and N4,
     respectively. Specifically, the information displayed for the second hop
     contains the incoming interface address 2001:db8:2:3:31:: at node N3.
     This matches the expected interface bound to End.X behavior
     2001:db8:K:2:X31:: (link3). Similarly, the information displayed for the fourth hop
     contains the incoming interface address 2001:db8:4:5::52:: at node N5.
     This matches the expected interface bound to the End.X behavior
     2001:db8:K:4:X52:: (link10). 
          </t>
        </section>
        <!--end: Tracerouting an IPv6 Address via a Segment list -->    

	<section numbered="true" toc="default">
          <name>Traceroute to a SID</name>

          <t>The mechanism to traceroute an IPv6 address via a segment list
          described in the previous section can also be used to traceroute a
          remote SID behavior, as explained in the following example.  The
          example uses traceroute to an End SID, as described in <xref
          target="RFC8986" format="default"/>, but the procedure is equally
          applicable to tracerouting any other SID behaviors.
          </t>
          <t>  Please note that traceroute to a SID is
     exemplified using UDP probes. However, the procedure is equally
     applicable to other implementations of traceroute mechanism.     
     The UDP encoded message to traceroute a SID would use the UDP ports 
     assigned by IANA for "traceroute use". 
          </t>
          <t> Consider the example where the user wants to traceroute a remote SID
    2001:db8:K:4::, via 2001:db8:K:2:X31::, from node N1. The
     traceroute probe is processed at the individual nodes along the path
     as follows: 
     
          </t>
          <ul spacing="normal">
            <li>Node N1 initiates a traceroute probe packet as follows
          (2001:db8:L:1::, 2001:db8:K:2:X31::)
          (2001:db8:K:4::, 2001:db8:K:2:X31::; SL=1; NH=UDP)(Traceroute probe). 
          The first traceroute probe is sent with the hop-count value set to 1. 
          The hop-count value is incremented by 1 for each subsequent traceroute probe. 

           </li>
            <li>When node N2 receives the packet with hop-count = 1, it
          processes the hop-count expiry. Specifically, node N2
          responds with the ICMPv6 message with type "Time Exceeded" and code
          "hop limit exceeded in transit". The ICMPv6 response 
	      is IP routed. 
	      
          </li>
            <li>When node N2 receives the packet with hop-count &gt; 1, it
          performs the standard SRH processing. Specifically, it executes
          the End.X behavior indicated by the 
          2001:db8:K:2:X31:: SID on the traceroute probe. 
          If 2001:db8:K:2:X31:: is a PSP SID, 
      node N2 executes the SID like any other data packet with DA = 2001:db8:K:2:X31:: 
      and removes the SRH. 
          </li>
            <li>When node N3, which is a non-SRv6-capable node, receives the packet
          with hop-count = 1, it processes the
          hop-count expiry. Specifically, node N3 responds with the
          ICMPv6 message with type "Time Exceeded" and code "Hop limit 
          exceeded in transit". The ICMPv6 response is IP routed. 
	
          </li>
            <li>When node N3, which is a non-SRv6-capable node, receives the packet
          with hop-count &gt; 1, it performs the standard IPv6 processing.
          Specifically, it forwards the traceroute probe based on DA
          2001:db8:K:4:: in the IPv6 header. </li>
            <li>When node N4 receives the packet with DA set to the local SID 2001:db8:K:4::, it
          processes the End SID. </li>
            <li>  If the target SID (2001:db8:K:4::) is not locally instantiated and 
          does not represent a local interface, the packet is discarded. 
     </li>
            <li>
          If the target SID (2001:db8:K:4::) is locally instantiated or represents a 
          local interface, the node processes 
          the Upper-Layer header. 
	  As part of the Upper-Layer header processing, node N4 responds
          with the ICMPv6 message with type "Destination Unreachable" and code
          "Port Unreachable". The ICMPv6 response 
	     is IP routed. 
	     
          </li>
          </ul>
          <t><xref target="sample-output"/> displays a sample traceroute output for this example. 
     
          </t>
	  <figure anchor="sample-output">
	    <name>Sample Output for Hop-by-Hop Traceroute to a SID</name>
<artwork name="" type="" align="left" alt=""><![CDATA[
  > traceroute 2001:db8:K:4:X52:: via segment list 2001:db8:K:2:X31::

  Tracing the route to SID 2001:db8:K:4:X52::
  1  2001:db8:2:1:21:: 0.512 msec 0.425 msec 0.374 msec
     DA: 2001:db8:K:2:X31::, 
     SRH:(2001:db8:K:4:X52::, 2001:db8:K:2:X31::; SL=1)
  2  2001:db8:3:2:21:: 0.721 msec 0.810 msec 0.795 msec
     DA: 2001:db8:K:4:X52::, 
     SRH:(2001:db8:K:4:X52::, 2001:db8:K:2:X31::; SL=0)
  3  2001:db8:4:3:41:: 0.921 msec 0.816 msec 0.759 msec
     DA: 2001:db8:K:4:X52::, 
     SRH:(2001:db8:K:4:X52::, 2001:db8:K:2:X31::; SL=0)
]]></artwork>
	  </figure>
        </section>
        <!--end: Traceroute to a SID behavior-->    

    </section>
      <!--end: Traceroute -->    	

	<section numbered="true" toc="default">
        <name>Hybrid OAM Using the OAM Flag</name>
        <t> This section illustrates a hybrid OAM mechanism using 
    the O-flag. Without loss of the generality, the illustration 
    assumes node N100 is a centralized controller. 
        </t>
        <t>
    This illustration is different from the "in situ OAM" defined in <xref
    target="RFC9197" format="default"/>.  This is because in situ OAM records
    operational and telemetry information in the packet as the packet
    traverses a path between two points in the network <xref target="RFC9197"
    format="default"/>.  The illustration in this subsection does not require
    the recording of OAM data in the packet.
        
</t>
        <t>    
The illustration does not assume any formats for exporting the data
	elements or the data elements that need to be exported. 
	The illustration assumes system clocks among all nodes in the SR domain are synchronized. 
</t>
        <t>  Consider the example where the user wants to monitor sampled IPv4 
    VPN 999 traffic going from CE1 to CE2 via a low-latency SR Policy P installed 
    at node N1. 
    To exercise a low-latency path, the SR Policy P forces the packet via segments 
    2001:db8:K:2:X31:: and 2001:db8:K:4:X52::. 
    The VPN SID at node N7 associated with VPN 999 is 2001:db8:K:7:DT999::. 
    2001:db8:K:7:DT999:: is a USP SID. 
    Nodes N1, N4, and N7 are capable of processing the O-flag, but 
    node N2 is not capable of processing the O-flag. 
    Node N100 is the centralized controller capable of processing and correlating 
    the copy of the packets sent from nodes N1, N4, and N7.     
    Node N100 is aware of O-flag processing capabilities.  
    Node N100, with help from nodes N1, N4, and N7, implements a hybrid 
    OAM mechanism using the O-flag as follows: 
     
        </t>
        <ul spacing="normal">
          <li> <t>A packet P1 is sent from CE1 to node N1. The packet is:</t>
	<t>P1: (IPv4 header)(payload)</t></li>
          <li> <t>Node N1 steers packet P1 through the SR Policy P. 
          Based on local configuration, node N1 also implements logic to sample 
          traffic steered through SR Policy P for hybrid OAM purposes. 
          Specification for the sampling logic is beyond the scope of this document. 
          Consider the case where packet P1 is classified as a packet to be monitored 
          via the hybrid OAM. 
          Node N1 sets the O-flag during the encapsulation required by SR Policy P. 
          As part of setting the O-flag, node N1 also sends a timestamped copy 
          of packet P1 to a local 
          OAM process. The packet is:</t>
	  <t>P1: (2001:db8:L:1::, 2001:db8:K:2:X31::) (2001:db8:K:7:DT999::,
	  2001:db8:K:4:X52::, 2001:db8:K:2:X31::; SL=2; O-flag=1;
	  NH=IPv4)(IPv4 header)(payload)</t>
	  <t>The local OAM process sends a full or partial copy of 
          packet P1 to node N100. 
          The OAM process includes the 
          recorded timestamp, additional 
          OAM information (like incoming and outgoing interface), and 
          any applicable metadata.
          Node N1 forwards the original packet towards the next 
          segment 2001:db8:K:2:X31::.</t> </li>
          <li> <t>When node N2 receives the packet with the O-flag set, it
          ignores the O-flag. This is because node N2 is not capable of
          processing the O-flag. Node N2 performs the standard SRv6 SID and
          SRH processing.  Specifically, it executes the End.X behavior <xref
          target="RFC8986" format="default"/>
          indicated by the 2001:db8:K:2:X31:: SID and forwards packet P1 over
          link3 towards node N3. The packet is:</t>
	  <t>P1: (2001:db8:L:1::, 2001:db8:K:4:X52::) (2001:db8:K:7:DT999::,
	  2001:db8:K:4:X52::, 2001:db8:K:2:X31::; SL=1; O-flag=1;
	  NH=IPv4)(IPv4 header)(payload)
	  </t>
          </li>
          <li>When node N3, which is a non-SRv6-capable node, receives packet P1, it performs the standard IPv6 processing.
          Specifically, it forwards packet P1 based on DA
          2001:db8:K:4:X52:: in the IPv6 header. 
          </li>
          <li><t>When node N4 receives packet P1, it processes the O-flag. The packet is:</t>
	  <t>P1: (2001:db8:L:1::, 2001:db8:K:4:X52::)
          (2001:db8:K:7:DT999::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::; SL=1; O-flag=1;
          NH=IPv4)(IPv4 header)(payload)
	  </t>
          <t>As part of processing the O-flag, it sends a timestamped copy of 
          the packet to a local OAM process. 
          Based on local configuration, the local OAM process sends a full or partial 
          copy of packet 
          P1 to node N100. The OAM process includes the 
          recorded timestamp, additional 
          OAM information (like incoming and outgoing interface, etc.), and
          any applicable metadata. 
          Node N4 performs the standard SRv6 SID and SRH processing on the original packet P1. 
          Specifically, it executes
          the End.X behavior indicated by the 2001:db8:K:4:X52:: SID and forwards packet P1 
          over link10 towards node N5. The packet is:</t>
	  <t>P1: (2001:db8:L:1::, 2001:db8:K:7:DT999::)
          (2001:db8:K:7:DT999::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::; SL=0; O-flag=1;
          NH=IPv4)(IPv4 header)(payload)
	  </t>
         </li>
          <li>When node N5, which is a non-SRv6-capable node, receives packet P1, 
          it performs the standard IPv6 processing.
          Specifically, it forwards the packet based on DA
          2001:db8:K:7:DT999:: in the IPv6 header. 
          </li>
          <li><t>When node N7 receives packet P1, it processes the O-flag. The packet is:</t>
	  <t>P1: (2001:db8:L:1::, 2001:db8:K:7:DT999::)
          (2001:db8:K:7:DT999::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::; SL=0; O-flag=1;
          NH=IPv4)(IPv4 header)(payload)
	  </t>
          <t>As part of processing the O-flag, it sends a timestamped copy of 
          the packet to a local OAM process. 
          The local OAM process sends a full or partial copy of packet 
          P1 to node N100. The OAM process includes the 
          recorded timestamp, additional 
          OAM information (like incoming and outgoing interface, etc.), and 
          any applicable metadata. 
          Node N7 performs the standard SRv6 SID and SRH processing on the original packet P1. 
          Specifically, it executes the VPN SID indicated by the 2001:db8:K:7:DT999:: SID 
          and, based on lookup in table 100, forwards packet P1 
          towards CE2. The packet is:</t>
	  <t>P1: (IPv4 header)(payload)
	  </t>
         </li>
          <li>
          Node N100 processes and correlates the copy of the packets 
          sent from nodes N1, N4, and N7 to find segment-by-segment delays and 
          provide other hybrid OAM information related to packet P1. 
          For segment-by-segment delay computation, it is assumed that clocks 
          are synchronized across the SR domain.
          
           </li>
          <li>
          The process continues for any other sampled packets.  </li>
        </ul>
      </section>
      <!--end: O-flag --> 	

	<section numbered="true" toc="default">
        <name>Monitoring of SRv6 Paths</name>
        <t>  In the recent past, network operators demonstrated interest in performing
   network OAM functions in a centralized manner.  <xref target="RFC8403" format="default"/>
     describes such a centralized OAM mechanism. Specifically, <xref target="RFC8403" format="default"/>
     describes a procedure that can be used to perform path continuity
     checks between any nodes within an SR domain from a centralized
     monitoring system. However, while <xref target="RFC8403" format="default"/> focuses on SR networks with MPLS data
     plane, this document describes how 
     the concept can be used to perform path monitoring in an SRv6 network 
     from a centralized controller. 
        </t>
        <t>  In the reference topology in <xref target="ref-top"/>, node N100 uses an IGP protocol
     like OSPF or IS-IS to get a view of the topology within the IGP domain.
     Node N100 can also use BGP-LS to get the complete view of an inter-domain
     topology. The controller leverages the visibility of
     the topology to monitor the paths between the various endpoints. 
        
        </t>
        <t>Node N100 advertises an End 
     SID <xref target="RFC8986" format="default"/> 2001:db8:K:100:1::. To monitor any 
     arbitrary SRv6 paths, the controller can create a loopback probe that originates and 
     terminates on node N100. To distinguish between a failure in the monitored path 
     and loss of connectivity between the controller and the network, 
     node N100 runs a suitable mechanism to monitor its connectivity to the monitored network. 
        </t>
        <t> 
     The following example illustrates loopback probes in which node N100 
     needs to verify a
     segment list &lt;2001:db8:K:2:X31::, 2001:db8:K:4:X52::&gt;:
     
        </t>
        <ul spacing="normal">
          <li>Node N100 generates an OAM packet (2001:db8:L:100::,
     	2001:db8:K:2:X31::)(2001:db8:K:100:1::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::, 
     	SL=2)(OAM Payload). The controller routes the probe packet towards the first 
     	segment, which is 2001:db8:K:2:X31::.
     	</li>
          <li>Node N2 executes the End.X behavior indicated by the 2001:db8:K:2:X31:: SID and 
     	forwards the packet 
     	 (2001:db8:L:100::,
     	2001:db8:K:4:X52::)(2001:db8:K:100:1::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::, 
     	SL=1)(OAM Payload) on link3 to node N3. 
     	</li>
          <li> Node N3, which is a non-SRv6-capable node, performs the standard
          IPv6 processing. Specifically, it forwards the packet
          based on DA 2001:db8:K:4:X52:: in the IPv6 header. </li>
          <li>Node N4 executes the End.X behavior indicated by the 2001:db8:K:4:X52:: SID and 
     	forwards the packet 
     	 (2001:db8:L:100::,
     	2001:db8:K:100:1::)(2001:db8:K:100:1::, 2001:db8:K:4:X52::, 2001:db8:K:2:X31::, 
     	SL=0)(OAM Payload) on link10 to node N5. 
     	</li>
          <li> Node N5, which is a non-SRv6-capable node, performs the standard
          IPv6 processing. Specifically, it forwards the packet
          based on DA 2001:db8:K:100:1:: in the IPv6 header. </li>
          <li>Node N100 executes the standard SRv6 END behavior. It 
     	decapsulates the header and consumes the probe for OAM processing. The information 
     	in the OAM payload is used to detect missing probes, round-trip delay, etc. 
     	</li>
        </ul>
        <t> The OAM payload type or 
     	the information carried in the OAM probe is a local implementation 
     	decision at the controller and is outside the scope of this document. 
        </t>
      </section>
      <!--end: Monitoring of SRv6 Paths -->    

    </section>
    <!--end: Illustrations--> 	

    <section anchor="Acknowledgements" numbered="false" toc="default">
      <name>Acknowledgements</name>
      <t> The authors would like to thank <contact fullname="Joel M. Halpern"/>, <contact fullname="Greg Mirsky"/>, 
      <contact fullname="Bob Hinden"/>, <contact fullname="Loa Andersson"/>, <contact fullname="Gaurav Naik"/>, <contact fullname="Ketan Talaulikar"/>, and <contact fullname="Haoyu Song"/>  
      for their review comments. </t>
    </section>
    <section anchor="Contributors" numbered="false" toc="default">
      <name>Contributors</name>
      <t>The following people contributed to this document:
      </t>
        <contact fullname="Robert Raszuk" >
        <organization>Bloomberg LP</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>robert@raszuk.net</email>
        </address>
      </contact>

      <contact fullname="John Leddy" >
        <organization>Individual</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>john@leddy.net</email>
        </address>
      </contact>      

      <contact fullname="Gaurav Dawra" >
        <organization>LinkedIn</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>gdawra.ietf@gmail.com</email>
        </address>
      </contact>      

      <contact fullname="Bart Peirens" >
        <organization>Proximus</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>bart.peirens@proximus.com</email>
        </address>
      </contact>      

      <contact fullname="Nagendra Kumar" >
        <organization>Cisco Systems, Inc.</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>naikumar@cisco.com</email>
        </address>
      </contact>      

      <contact fullname="Carlos Pignataro" >
        <organization>Cisco Systems, Inc.</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>cpignata@cisco.com</email>
        </address>
      </contact>      

      <contact fullname="Rakesh Gandhi" >
        <organization>Cisco Systems, Inc.</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>rgandhi@cisco.com</email>
        </address>
      </contact>      

      <contact fullname="Frank Brockners" >
        <organization>Cisco Systems, Inc.</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>fbrockne@cisco.com</email>
        </address>
      </contact>      

      <contact fullname="Darren Dukes" >
        <organization>Cisco Systems, Inc.</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>ddukes@cisco.com</email>
        </address>
      </contact>      

      <contact fullname="Cheng Li" >
        <organization>Huawei</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>chengli13@huawei.com</email>
        </address>
      </contact>      

      <contact fullname="Faisal Iqbal" >
        <organization>Individual</organization>
        <address>
          <postal>
            <street></street>
            <city></city>
            <region></region><code></code>
            <country></country>
          </postal>
          <email>faisal.ietf@gmail.com</email>
        </address>
      </contact>      
    </section>

  </back>
</rfc>
