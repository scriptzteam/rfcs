<?xml version='1.0' encoding='UTF-8'?>

<!-- draft submitted in xml v3 --> 

<!DOCTYPE rfc [
 <!ENTITY nbsp    "&#160;">
 <!ENTITY zwsp   "&#8203;">
 <!ENTITY nbhy   "&#8209;">
 <!ENTITY wj     "&#8288;">
]> 

<rfc xmlns:xi="http://www.w3.org/2001/XInclude" 
ipr="trust200902" 
docName="draft-ietf-drip-auth-49" 
number="9575"
category="std" 
obsoletes="" 
updates="" 
submissionType="IETF" 
xml:lang="en" 
consensus="true"
tocInclude="true" 
sortRefs="true" 
symRefs="true" 
version="3">

  <front>
    <title abbrev="DRIP Auth Formats">DRIP Entity Tag (DET) Authentication Formats and Protocols for Broadcast Remote Identification (RID)</title>
    <seriesInfo name="RFC" value="9575"/>
    <author initials="A." surname="Wiethuechter" fullname="Adam Wiethuechter" role="editor">
      <organization>AX Enterprize, LLC</organization>
      <address>
        <postal>
          <street>4947 Commercial Drive</street>
          <city>Yorkville</city>
          <region>NY</region>
          <code>13495</code>
          <country>United States of America</country>
        </postal>
        <email>adam.wiethuechter@axenterprize.com</email>
      </address>
    </author>
    <author initials="S." surname="Card" fullname="Stuart Card">
      <organization>AX Enterprize, LLC</organization>
      <address>
        <postal>
          <street>4947 Commercial Drive</street>
          <city>Yorkville</city>
          <region>NY</region>
          <code>13495</code>
          <country>United States of America</country>
        </postal>
        <email>stu.card@axenterprize.com</email>
      </address>
    </author>
    <author initials="R." surname="Moskowitz" fullname="Robert Moskowitz">
      <organization>HTT Consulting</organization>
      <address>
        <postal>
          <street/>
          <city>Oak Park</city>
          <region>MI</region>
          <code>48237</code>
          <country>United States of America</country>
        </postal>
        <email>rgm@labs.htt-consult.com</email>
      </address>
    </author>
    <date year="2024" month="June"/>

    <area>INT</area>
    <workgroup>drip</workgroup>

<keyword>drone</keyword>
<keyword>UAS</keyword>
<keyword>Broadcast RID</keyword>
<keyword>trustworthy remote identification</keyword>
<keyword>anti-spoofing</keyword>

    <abstract>
      <t>The Drone Remote Identification Protocol (DRIP), plus trust policies and periodic access to registries, augments Unmanned Aircraft System (UAS) Remote Identification (RID), enabling local real-time assessment of trustworthiness of received RID messages and observed UAS, even by Observers lacking Internet access. This document defines DRIP message types and formats to be sent in Broadcast RID Authentication Messages to verify that attached and recently detached messages were signed by the registered owner of the DRIP Entity Tag (DET) claimed.</t>
    </abstract>
  </front>
  <middle>
    <section anchor="introduction" numbered="true" toc="default">
      <name>Introduction</name>
      <t>The initial regulations (e.g., <xref target="FAA-14CFR" format="default"/>) and standards (e.g., <xref target="F3411" format="default"/>) for Unmanned Aircraft  Systems (UAS) Remote Identification (RID) and tracking do not address trust. However, this is a requirement that needs to be addressed for various different parties that have a stake in the safe operation of National Airspace Systems (NAS). Drone Remote ID Protocol's (DRIP's) goal is to specify how RID can be made trustworthy and available in both Internet and local-only connected scenarios, especially in emergency situations.</t>
      <t>UAS often operate in a volatile environment. A small Unmanned Aircraft (UA) offers little capacity for computation and communication. UAS RID must also be accessible with ubiquitous and inexpensive devices without modification. This limits options. Most current small UAS are Internet of Things (IoT) devices even if they are not typically thought of as such. Thus many IoT considerations apply here. Some DRIP work, currently strongly scoped to UAS RID, is likely to be applicable to some other IoT use cases.</t>

      <t>Generally, two communication schemes for UAS RID are considered: Broadcast and Network. This document focuses on adding trust to Broadcast RID (<xref target="RFC9153" sectionFormat="of" section="3.2"/> and <xref target="RFC9434" sectionFormat="of" section="1.2.2"/>). As defined in <xref target="F3411" format="default"/> and outlined in <xref target="RFC9153" format="default"/> and <xref target="RFC9434" format="default"/>, Broadcast RID is a one-way Radio Frequency (RF) transmission of Media Access Control (MAC) layer messages over Bluetooth or Wi-Fi.</t>
      <t>Senders can make any claims the RID message formats allow. Observers have no standardized means to assess the trustworthiness of message content, nor verify whether the messages were sent by the UA identified therein, nor confirm that the UA identified therein is the one they are visually observing. Indeed, Observers have no way to detect whether the messages were sent by a UA or spoofed by some other transmitter (e.g., a laptop or smartphone) anywhere in direct wireless broadcast range. Authentication is the primary strategy for mitigating this issue.</t>
      <section anchor="drip-entity-tag-det-authentication-goals-for-broadcast-rid" numbered="true" toc="default">
        <name>DRIP Entity Tag (DET) Authentication Goals for Broadcast RID</name>
        <t>ASTM <xref target="F3411" format="default"/> Authentication Messages (Message Type 0x2), when used with DET-based formats <xref target="RFC9374" format="default"/>, enable a high level of trust that the content of other ASTM Messages was generated by their claimed registered source. These messages are designed to provide the Observers with trustworthy and immediately actionable information. <xref target="auth-state-diagrams" format="default"/> provides a high-level overview of the various states of trustworthiness that may be used along with these formats.</t>

        <t>This authentication approach also provides some error correction (<xref target="fec-details" format="default"/>) as mandated by the United States (US) Federal Aviation Administration (FAA) <xref target="FAA-14CFR" format="default"/>, which is missing from <xref target="F3411" format="default"/> over Legacy Transports (Bluetooth 4.x).</t>
        <t>These DRIP enhancements to ASTM's specification for RID and tracking <xref target="F3411" format="default"/> further support the important use case of Observers who may be offline at the time of observation.</t>
        <t><xref target="req-sum" format="default"/> summarizes the DRIP requirements <xref target="RFC9153" format="default"/> addressed herein.</t>

      </section>
    </section>
    <section anchor="terminology" numbered="true" toc="default">
      <name>Terminology</name>
      <section anchor="required-terminology" numbered="true" toc="default">
        <name>Required Terminology</name>
        <t>
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>",
    "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>",
    "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>",
    "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be
    interpreted as described in BCP&nbsp;14 <xref target="RFC2119"/> <xref
    target="RFC8174"/> when, and only when, they appear in all capitals, as
    shown here.
        </t>
      </section>
      <section anchor="definitions" numbered="true" toc="default">
        <name>Definitions</name>
        <t>This document makes use of the terms (CAA, Observer, USS, UTM, etc.) defined in <xref target="RFC9153" format="default"/>. Other terms (such as DIME) are from <xref target="RFC9434" format="default"/>, while others (HI, DET, RAA, HDA, etc.) are from <xref target="RFC9374" format="default"/>.</t>
        <t>In addition, the following terms are defined for this document:</t>
	<dl>
        <dt>Extended Transports:</dt>
        <dd>Use of extended advertisements (Bluetooth 5.x), service info
        (Wi-Fi Neighbor Awareness Networking (NAN)), or IEEE 802.11 Beacons
        with the vendor-specific information element as specified in <xref
        target="F3411" format="default"/>. Must use ASTM Message Pack (Message
        Type 0xF).</dd>
        <dt>Legacy Transports:</dt>
        <dd>Use of broadcast frames (Bluetooth 4.x) as specified in <xref
        target="F3411" format="default"/>.</dd>
        <dt>Manifest:</dt>
        <dd>An immutable list of items being transported (in this specific case over wireless communication).</dd>
<dt>Observation Session:</dt><dd>The period of time during which a given Observer's receiver is processing (even if only intermittently) a series of UAS RID messages, at least some of which use DRIP extensions to <xref target="F3411"/>, all nominally from the same UA executing a single flight operation.</dd>
        </dl>
<t>Note: For the remainder of this document, <em>Broadcast Endorsement: Parent, Child</em> will be abbreviated as <em>BE: Parent, Child</em>. For example, <em>Broadcast Endorsement: RAA, HDA</em> will be abbreviated as <em>BE: RAA, HDA</em>.</t>
      </section>
    </section>
    <section anchor="uas-rid-authentication-background-procedures" numbered="true" toc="default">
      <name>UAS RID Authentication Background and Procedures</name>
      <section anchor="protocol-desc" numbered="true" toc="default">
        <name>DRIP Authentication Protocol Description</name>
        <t><xref target="F3411" format="default"/> defines Authentication Message framing only. It does not define authentication formats or methods. It explicitly anticipates several signature options but does not fully define those. Annex A1 of <xref target="F3411" format="default"/> defines a Broadcast Authentication Verifier Service, which has a heavy reliance on Observer real-time connectivity to the Internet. Fortunately, <xref target="F3411" format="default"/> also allows third-party standard Authentication Types using the Type 0x5 Specific Authentication Method (SAM), several of which DRIP defines herein.</t>

        <t>The standardization of specific formats to support the DRIP requirements in UAS RID for trustworthy communications over Broadcast RID is an important part of the chain of trust for a UAS ID. Per <xref target="RFC9434" sectionFormat="of" section="5"/>, Authentication formats are needed to relay information for Observers to determine trust. No existing formats (defined in <xref target="F3411" format="default"/> or other organizations leveraging this feature) provide  functionality to satisfy this goal, resulting in the work reflected in this document.</t>
        <section anchor="auth-dns" numbered="true" toc="default">
          <name>Usage of DNS</name>
          <t>Like most aviation matters, the overall objectives here are security and ultimately safety oriented. Since DRIP depends on DNS for some of its functions, DRIP usage of DNS needs to be protected per best security practices. Many participating nodes will have limited local processing power and/or poor, low-bandwidth QoS paths. Appropriate and feasible security techniques will be highly dependent on the UAS and Observer situation. Therefore, specification of particular DNS security options, transports, etc. is outside the scope of this document (see also <xref target="dns-security" format="default"/>).</t>
          <t>In DRIP, Observers <bcp14>MUST</bcp14> validate all signatures received. This requires that the Host Identity (HI) correspond to a DET <xref target="RFC9374" format="default"/>. HI's <bcp14>MAY</bcp14> be retrieved from a local cache, if present. The local cache is pre-configured with well-known HIs (such as those of CAA DIMEs) and is further populated by received Broadcast Endorsements (BEs) (<xref target="dime-attestation" format="default"/>) and DNS lookups (when available).</t>
          <t>The Observer <bcp14>MUST</bcp14> perform a DNS query, when connectivity allows, to obtain a previously unknown HI. If a query cannot be performed, the message <bcp14>SHOULD</bcp14> be cached by the Observer to be validated once the HI is obtained.</t>
          <t>A more comprehensive specification of DRIP's use of DNS is out of scope for this document and can be found in <xref target="I-D.ietf-drip-registries" format="default"/>.</t>
        </section>
        <section anchor="rid-trust" numbered="true" toc="default">
          <name>Providing UAS RID Trust</name>
          <t>For DRIP, two actions together provide a mechanism for an Observer to trust in UAS RID using Authentication Messages.</t>
          <t>First is the transmission of an entire trust chain via Broadcast Endorsements (<xref target="dime-attestation" format="default"/>). This provides a hierarchy of DIMEs down to and including an individual UA's registration of a claimed DET and corresponding HI (public key). This alone cannot be trusted as having any relevance to the observed UA because replay attacks are trivial.</t>
          <t>After an Observer has gathered such a complete key trust chain (from pre-configured cache entries, Broadcast Endorsements received over the air and/or DNS lookups) and verified all of its links, that device can trust that the claimed DET and corresponding public key are properly registered, but the UA has not yet been proven to possess the corresponding private key.</t>
          <t>Second is for the UA to prove possession by dynamically signing data that is unique and unpredictable but easily verified by the Observer (<xref target="ua-attestation" format="default"/>). Verification of this signed data <bcp14>MUST</bcp14> be performed by the Observer as part of the received UAS RID information trust assessment (<xref target="trust-assessment" format="default"/>).</t>
          <section anchor="dime-attestation" numbered="true" toc="default">
            <name>DIME Endorsements of Subordinate DETs</name>
            <t>Observers receive DRIP Link Authentication Messages (<xref target="drip-link" format="default"/>) containing Broadcast Endorsements by DIMEs of child DET registrations. A series of these Endorsements confirms a path through the hierarchy, defined in <xref target="I-D.ietf-drip-registries" format="default"/>, from the DET Prefix Owner all the way to an individual UA DET registration.</t>
          </section>
          <section anchor="ua-attestation" numbered="true" toc="default">
            <name>UA-Signed Evidence</name>
            <t>To prove possession of the private key associated with the DET, the UA <bcp14>MUST</bcp14> sign and send data that is unique and unpredictable but easily validated by the Observer. The data can be an ASTM Message that fulfills the requirements to be unpredictable but easily validated. An Observer receives this UA-signed Evidence from DRIP-based Authentication Messages (Sections <xref target="drip-wrapper" format="counter"/> or <xref target="drip-manifest" format="counter"/>). The Observer must verify the signature (cryptographically, as specified in <xref target="auth-dns"/>) and validate the signed content (via non-cryptographic means, as specified in <xref target="drip-recommendations"/>).</t>

            <t>Whether the content is true is a separate question that DRIP cannot address, but validation performed using observable and/or out-of-band data (<xref target="reqs" format="default"/>) is possible and encouraged.</t>
          </section>
        </section>
      </section>
      <section anchor="auth-message" numbered="true" toc="default">
        <name>ASTM Authentication Message Framing</name>
        <t>The Authentication Message (Message Type 0x2) is unique in the ASTM  <xref target="F3411" format="default"/> Broadcast standard, as it is the only message that can be larger than the Legacy Transport size. To address this limitation around transport size, it is defined as a set of "pages", each of which fits into a single Legacy Transport frame. For Extended Transports, pages are still used but they are all in a single frame.</t>
        <aside><t>Informational Note: Message Pack (Message Type 0xF) is also
        larger than the Legacy Transport size but is limited for use only on
        Extended Transports where it can be supported.</t></aside>
        <t>The following subsections are a brief overview of the Authentication Message format defined in <xref target="F3411" format="default"/> for better context on how DRIP Authentication fills and uses various fields already defined by ASTM <xref target="F3411" format="default"/>.</t>
        <section anchor="auth-page" numbered="true" toc="default">
          <name>Authentication Page</name>
          <t>This document leverages Authentication Type 0x5 (Specific Authentication Method (SAM)) as the principal authentication container, defining a set of SAM Types in <xref target="drip-authentication-formats" format="default"/>. Authentication Type is encoded in every Authentication Page in the <em>Page Header</em>. The SAM Type is defined as a field in the <em>Authentication Payload</em> (see <xref target="sam-data" format="default"/>).</t>
          <figure anchor="astm-auth-page">
            <name>Standard ASTM Authentication Message Page</name>
            <artwork align="center" name="" type="" alt=""><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|  Page Header  |                                               |
+---------------+                                               |
|                                                               |
|                                                               |
|                     Authentication Payload                    |
|                                                               |
|                                                               |
+---------------+---------------+---------------+---------------+
]]></artwork>
          </figure>
<dl><dt><em>Page Header</em>:</dt><dd><t>(1 octet)</t>
          <t>Authentication Type (4 bits) and Page Number (4 bits)</t></dd>

          <dt><em>Authentication Payload</em>:</dt><dd><t>(23 octets per page)</t>
          <t>Authentication Payload, including headers. Null padded. See
            <xref target="auth-payload" format="default"/>.</t></dd>
</dl>
          <t>The Authentication Message is structured as a set of pages per <xref target="astm-auth-page" format="default"/>. There is a technical maximum of 16 pages (indexed 0 to 15) that can be sent for a single Authentication Message, with each page carrying a maximum 23-octet <em>Authentication Payload</em>. See <xref target="drip-restrictions" format="default"/> for more details. Over Legacy Transports, these messages are "fragmented", with each page sent in a separate Legacy Transport frame.</t>
          <t>Either as a single Authentication Message or a set of fragmented Authentication Message Pages, the structure is further wrapped by outer ASTM framing and the specific link framing.</t>
        </section>
        <section anchor="auth-payload" numbered="true" toc="default">
          <name>Authentication Payload Field</name>
          <t><xref target="astm-auth" format="default"/> is the source data view of the data fields found in the Authentication Message as defined by <xref target="F3411" format="default"/>. This data is placed into the <em>Authentication Payload</em> shown in <xref target="astm-auth-page" format="default"/>, which spans multiple <em>Authentication Pages</em>.</t>
          <figure anchor="astm-auth">
            <name>ASTM Authentication Message Fields</name>
            <artwork align="center" name="" type="" alt=""><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|                     Authentication Headers                    |
|                               +---------------+---------------+
|                               |                               |
+---------------+---------------+                               |
.                                                               .
.                Authentication Data / Signature                .
.                                                               .
|                                                               |
+---------------+---------------+---------------+---------------+
|      ADL      |                                               |
+---------------+                                               |
.                                                               .
.                       Additional Data                         .
.                                                               .
|                                                               |
+---------------+---------------+---------------+---------------+
]]></artwork>
          </figure>
<dl><dt><em>Authentication Headers</em>:</dt><dd><t>(6 octets)</t>
          <t>As defined in <xref target="F3411" format="default"/>.</t></dd>
          <dt><em>Authentication Data / Signature</em>:</dt><dd><t>(0 to 255 octets)</t>
          <t>Opaque authentication data. The length of this payload is
            known through a field in the <em>Authentication Headers</em>
            (defined in <xref target="F3411" format="default"/>).</t></dd>
          <dt><em>Additional Data Length (ADL)</em>:</dt><dd><t>(1 octet - unsigned)</t>
          <t>Length in octets of <em>Additional Data</em>. The
          value of <em>ADL</em> is calculated as the minimum of <tt>361 -
          Authentication Data / Signature Length</tt> and <tt>255</tt>. Only
          present with <em>Additional Data</em>.</t></dd>
          <dt><em>Additional Data:</em></dt><dd><t>(<em>ADL</em> octets)</t>
          <t>Data that follows the <em>Authentication Data /
          Signature</em> but is not considered part of the <em>Authentication
          Data</em>, and thus is not covered by a signature. For DRIP, this field
          is used to carry Forward Error Correction (FEC) generated by
          transmitters and parsed by receivers as defined in <xref
          target="fec-details" format="default"/>.</t></dd></dl>
        </section>
          <section anchor="sam-data" numbered="true" toc="default">
          <name>SAM Data Format</name>
            <t><xref target="sam-frame" format="default"/> is the general format to hold authentication data when using SAM and is placed inside the <em>Authentication Data / Signature</em> field in <xref target="astm-auth" format="default"/>.</t>
            <figure anchor="sam-frame">
              <name>SAM Data Format</name>
              <artwork align="center" name="" type="" alt=""><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|   SAM Type    |                                               |
+---------------+                                               |
.                                                               .
.                     SAM Authentication Data                   .
.                                                               .
|                                                               |
+---------------+---------------+---------------+---------------+
]]></artwork>
            </figure>

<dl><dt><em>SAM Type</em>:</dt><dd><t>(1 octet)</t>
            <t>The following SAM Types are allocated to DRIP:</t>
            <table align="center">
              <name>DRIP SAM Types</name>
              <thead>
                <tr>
                  <th align="left">SAM Type</th>
                  <th align="left">Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td align="left">0x01</td>
                  <td align="left">DRIP Link (<xref target="drip-link" format="default"/>)</td>
                </tr>
                <tr>
                  <td align="left">0x02</td>
                  <td align="left">DRIP Wrapper (<xref target="drip-wrapper" format="default"/>)</td>
                </tr>
                <tr>
                  <td align="left">0x03</td>
                  <td align="left">DRIP Manifest (<xref target="drip-manifest" format="default"/>)</td>
                </tr>
                <tr>
                  <td align="left">0x04</td>
                  <td align="left">DRIP Frame (<xref target="drip-frame" format="default"/>)</td>
                </tr>
              </tbody>
            </table>
	  </dd></dl>
              <aside><t>Note: ASTM International is the owner of these code points as they are defined in <xref target="F3411" format="default"/>. In accordance with Annex 5 of <xref target="F3411" format="default"/>, the International Civil Aviation Organization (ICAO) has been selected by ASTM as the registrar to manage allocations of these code points. The list is available at <xref target="ASTM-Remote-ID" format="default"/>.</t></aside>

<dl><dt><em>SAM Authentication Data</em>:</dt><dd><t>(0 to 200 octets)</t>
            <t>Contains opaque authentication data formatted as defined by the preceding SAM Type.</t></dd></dl>
          </section>

        <section anchor="drip-restrictions" numbered="true" toc="default">
          <name>ASTM Broadcast RID Constraints</name>
          <section anchor="wireless-frame-constraints" numbered="true" toc="default">
            <name>Wireless Frame Constraints</name>

            <t>A UA has the option to broadcast using Bluetooth (4.x and 5.x), Wi-Fi NAN, or IEEE 802.11 Beacon; see <xref target="reqs" format="default"/>. With Bluetooth, FAA and other Civil Aviation Authorities (CAA) mandate transmitting simultaneously over both 4.x and 5.x. The same application-layer information defined in <xref target="F3411" format="default"/> <bcp14>MUST</bcp14> be transmitted over all the physical-layer interfaces performing RID, because Observer transports may be limited. 
  If an Observer can
  support multiple transports, it should use (display, report, etc.) the latest
  data regardless of the transport over which that data was received.

</t>
            <t>Bluetooth 4.x presents a payload-size challenge in that it can only transmit 25 octets of payload per frame, while other transports can support larger payloads per frame.  As <xref target="F3411" format="default"/> message formats are the same for all media,
  and their framing was designed to fit within these legacy constraints,
  Extended Transports cannot send larger messages;
  instead, the Message Pack format encapsulates multiple messages
  (each of which fits within these legacy constraints).</t>

            <t>By definition Extended Transports provide FEC,
  but Legacy Transports lack FEC. Thus over Legacy Transports, paged
  Authentication Messages may suffer the loss of one or more pages.
  This would result in delivery to the Observer application of incomplete
  (typically unusable) messages, so DRIP FEC (<xref target="fec-details" format="default"/>) is specified
  to enable recovery of a single lost page and thereby reduce the likelihood
  of receiving incompletely reconstructable Authentication Messages.
Authentication Messages sent using Extended Transports do not suffer this issue, as the full message (all pages) is sent using a single Message Pack. Furthermore, the use of one-way RF broadcasts prohibits the use of any congestion-control or loss-recovery schemes that require ACKs or NACKs.</t>
          </section>
          <section anchor="paged-authentication-message-constraints" numbered="true" toc="default">
            <name>Paged Authentication Message Constraints</name>
            <t>To keep consistent formatting across the different transports (Legacy and Extended) and their independent restrictions, the authentication data being sent is <bcp14>REQUIRED</bcp14> to fit within the page limit that the most constrained existing transport can support. Under Broadcast RID, the Extended Transport that can hold the least amount of authentication data is Bluetooth 5.x at 9 pages.</t>
            <t>As such, DRIP transmitters are <bcp14>REQUIRED</bcp14> to adhere to the following when using the Authentication Message:</t>
            <ol spacing="normal" type="1">
	      <li><em>Authentication Data / Signature</em> data
	      <bcp14>MUST</bcp14> fit in the first 9 pages (Page Numbers 0
	      through 8).</li>
              <li>The <em>Length</em> field in the <em>Authentication
              Headers</em> (which encodes the length in octets of
              <em>Authentication Data / Signature</em> only) <bcp14>MUST
              NOT</bcp14> exceed the value of 201. This includes the SAM Type
              but excludes <em>Additional Data</em>.</li>
            </ol>
          </section>
          <section anchor="astm-timestamps" numbered="true" toc="default">
            <name>Timestamps</name>
            <t>In ASTM <xref target="F3411" format="default"/>, timestamps are a Unix-style timestamp with an epoch of <tt>2019-01-01 00:00:00 UTC</tt>. For DRIP, this format is adopted for Authentication to keep a common time format in Broadcast payloads.</t>
            <t>Under DRIP, there are two timestamps defined: <tt>Valid Not Before (VNB)</tt> and <tt>Valid Not After (VNA)</tt>.</t>
<dl><dt>Valid Not Before (VNB) Timestamp:</dt><dd><t>(4 octets)</t>
            <t>Timestamp denoting the recommended time at which to start trusting data. <bcp14>MUST</bcp14> follow the format defined in <xref target="F3411" format="default"/> as described above. <bcp14>MUST</bcp14> be set no earlier than the time the signature (across a given structure) is generated.</t></dd>

            <dt>Valid Not After (VNA) Timestamp:</dt><dd><t>(4 octets)</t>
            <t>Timestamp denoting the recommended time at which to stop trusting data. <bcp14>MUST</bcp14> follow the format defined in <xref target="F3411" format="default"/> as described above. Has an offset (relative to <tt>VNB</tt>) to avoid replay attacks. The exact offset is not defined in this document. Best practice for identifying an acceptable offset should be used and should take into consideration the UA environment, propagation characteristics of the messages being sent, and clock differences between the UA and Observers.
  For UA signatures in scenarios typical as of 2024, a reasonable offset would be
  to set <tt>VNA</tt> approximately 2 minutes after <tt>VNB</tt>; see <xref target="operational-proof"/> for examples
  that may aid in tuning this value.</t></dd></dl>
          </section>
        </section>
      </section>
    </section>
    <section anchor="drip-authentication-formats" numbered="true" toc="default">
      <name>DRIP Authentication Formats</name>
      <t>All formats defined in this section are contained in the <em>Authentication Data / Signature</em> field in <xref target="astm-auth" format="default"/> and use the Specific Authentication Method (SAM, Authentication Type 0x5). The first octet of the <em>Authentication Data / Signature</em> of <xref target="astm-auth" format="default"/> is used to multiplex among these various formats.</t>
      <t>
   When sending data over a medium that does not have underlying FEC,
   for example Legacy Transports, then FEC (per <xref target="fec-details" format="default"/>) <bcp14>MUST</bcp14> be used.
</t>
      <t>Examples of Link, Wrapper, and Manifest are shown as part of an operational schedule in <xref target="raw-example" format="default"/>.</t>
      <section anchor="bas" numbered="true" toc="default">
        <name>UA-Signed Evidence Structure</name>

        <t>The <em>UA-Signed Evidence Structure</em> (<xref target="drip-data" format="default"/>) is used by the UA during flight to sign over information elements using the private key associated with the current UA DET. It is encapsulated by the <em>SAM Authentication Data</em> field of <xref target="sam-frame" format="default"/>.</t>
        <t>This structure is used by the DRIP Wrapper (<xref target="drip-wrapper" format="default"/>), Manifest (<xref target="drip-manifest" format="default"/>), and Frame (<xref target="drip-frame" format="default"/>). DRIP Link (<xref target="drip-link" format="default"/>) <bcp14>MUST NOT</bcp14> use it, as it will not fit in the ASTM Authentication Message with its intended content (i.e., a Broadcast Endorsement).</t>
        <figure anchor="drip-data">
          <name>Endorsement Structure for UA-Signed Evidence</name>
          <artwork align="center" name="" type="" alt=""><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|                      VNB Timestamp by UA                      |
+---------------+---------------+---------------+---------------+
|                      VNA Timestamp by UA                      |
+---------------+---------------+---------------+---------------+
|                                                               |
.                                                               .
.                            Evidence                           .
.                                                               .
|                                                               |
+---------------+---------------+---------------+---------------+
|                                                               |
|                              UA                               |
|                        DRIP Entity Tag                        |
|                                                               |
+---------------+---------------+---------------+---------------+
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                          UA Signature                         |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
+---------------+---------------+---------------+---------------+
]]></artwork>
        </figure>
<dl><dt><em>Valid Not Before (VNB) Timestamp by UA</em>:</dt><dd><t>(4 octets)</t>
        <t>See <xref target="astm-timestamps" format="default"/>. Set by the UA.</t></dd>
        
        <dt><em>Valid Not After (VNA) Timestamp by UA</em>:</dt><dd><t>(4 octets)</t>
	<t>See <xref target="astm-timestamps" format="default"/>. Set by the UA.</t></dd>
        <dt><em>Evidence</em>:</dt><dd><t>(0 to 112 octets)</t>
        <t>The <em>Evidence</em> field <bcp14>MUST</bcp14> be filled in with data in the form of an opaque object specified in the DRIP Wrapper (<xref target="drip-wrapper" format="default"/>), Manifest (<xref target="drip-manifest" format="default"/>), or Frame (<xref target="drip-frame" format="default"/>).</t></dd>

        <dt><em>UA DRIP Entity Tag</em>:</dt><dd><t>(16 octets)</t>

        <t>
  This is a DET <xref target="RFC9374" format="default"/> currently being used by the UA for authentication;
  it is assumed to be a Specific Session ID (a type of UAS ID typically also
  used by the UA in the Basic ID Message).</t></dd>

        <dt><em>UA Signature</em>:</dt><dd><t>(64 octets)</t>
        <t>Signature over the concatenation of preceding fields (<em>VNB</em>, <em>VNA</em>, <em>Evidence</em>, and <em>UA DET</em>) using the keypair of the UA DET. The signature algorithm is specified by the Hierarchical Host Identity Tags (HHIT) Suite ID of the DET.</t></dd></dl>

        <t>When using this structure, the UA is minimally self-endorsing its DET. The HI of the UA DET can be looked up by mechanisms described in <xref target="I-D.ietf-drip-registries" format="default"/> or by extracting it from a Broadcast Endorsement (see Sections <xref target="drip-link" format="counter"/> and <xref target="drip-recommendations" format="counter"/>).</t>
      </section>
      <section anchor="drip-link" numbered="true" toc="default">
        <name>DRIP Link</name>
        <t>This SAM Type (<xref target="link-fig"/>) is used to transmit Broadcast Endorsements. For example,  the <em>BE: HDA, UA</em> is sent (see <xref target="drip-recommendations" format="default"/>) as a DRIP Link message.</t>
        <t>DRIP Link is important as its contents are used to provide trust in the DET/HI pair that the UA is currently broadcasting. This message does not require Internet connectivity to perform signature verification of the contents when the DIME DET/HI is in the Observer's cache. It also provides the UA HI, when it is filled with a <tt>BE: HDA, UA</tt>, so that connectivity is not required when performing signature verification of other DRIP Authentication Messages.</t>
        <t>
  Various Broadcast Endorsements are sent during each UAS flight operation to ensure
  that the full Broadcast Endorsement chain is available offline.
See <xref target="drip-recommendations" format="default"/> for further details.</t>
        <figure anchor="link-fig">
          <name>Broadcast Endorsement / DRIP Link</name>
          <artwork align="center" name="" type="" alt=""><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|                    VNB Timestamp by Parent                    |
+---------------+---------------+---------------+---------------+
|                    VNA Timestamp by Parent                    |
+---------------+---------------+---------------+---------------+
|                                                               |
|                              DET                              |
|                            of Child                           |
|                                                               |
+---------------+---------------+---------------+---------------+
|                                                               |
|                                                               |
|                                                               |
|                           HI of Child                         |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
+---------------+---------------+---------------+---------------+
|                                                               |
|                              DET                              |
|                           of Parent                           |
|                                                               |
+---------------+---------------+---------------+---------------+
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                     Signature by Parent                       |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
+---------------+---------------+---------------+---------------+
]]></artwork>
        </figure>
<dl><dt><em>VNB Timestamp by Parent</em>:</dt><dd><t>(4 octets)</t>
        <t>See <xref target="astm-timestamps" format="default"/>. Set by Parent Entity.</t></dd>
        <dt><em>VNA Timestamp by Parent</em>:</dt><dd><t>(4 octets)</t>
        <t>See <xref target="astm-timestamps" format="default"/>. Set by Parent Entity.</t></dd>
        <dt><em>DET of Child</em>:</dt><dd><t>(16 octets)</t>
        <t>DRIP Entity Tag of Child Entity.</t></dd>
        <dt><em>HI of Child</em>:</dt><dd><t>(32 octets)</t>
        <t>Host Identity of Child Entity.</t></dd>
        <dt><em>DET of Parent</em>:</dt><dd><t>(16 octets)</t>
        <t>DRIP Entity Tag of Parent Entity in DIME Hierarchy.</t></dd>
        <dt><em>Signature by Parent</em>:</dt><dd><t>(64 octets)</t>
        <t>Signature over concatenation of preceding fields (<em>VNB</em>, <em>VNA</em>, <em>DET of Child</em>, <em>HI of Child</em>, and <em>DET of Parent</em>) using the keypair of the Parent DET.</t></dd></dl>
        <t>This DRIP Authentication Message is used in conjunction with other DRIP SAM Types (such as the Manifest or the Wrapper) that contain data (e.g., the ASTM Location/Vector Message, Message Type 0x2) that is guaranteed to be unique, unpredictable, and easily cross-checked by the receiving device.</t>
        <t>A hash of the final link (<tt>BE: HDA on UA</tt>) in the Broadcast Endorsement chain <bcp14>MUST</bcp14> be included in each DRIP Manifest (<xref target="drip-manifest" format="default"/>).</t>

         <t>Note: The Endorsement that proves a DET is registered <bcp14>MUST</bcp14> come from its immediate parent in the registration hierarchy, e.g., a DRIP Identity Management Entity (DIME) <xref target="I-D.ietf-drip-registries" format="default"/>. In the definitive hierarchy, the parent of the UA is its HHIT Domain Authority (HDA), the parent of an HDA is its Registered Assigning
Authority (RAA), etc. It is also assumed that all DRIP-aware entities use a DET as their identifier 
during interactions with other DRIP-aware entities.</t>

      </section>
      <section anchor="drip-wrapper" numbered="true" toc="default">
        <name>DRIP Wrapper</name>
        <t>This SAM Type is used to wrap and sign over a list of other <xref target="F3411" format="default"/> Broadcast RID messages.</t>
        <t>The <em>Evidence</em> field of the <em>UA-Signed Evidence Structure</em> (<xref target="bas" format="default"/>) is populated with up to four ASTM Messages <xref target="F3411" format="default"/> in a contiguous octet sequence. Only ASTM Message Types 0x0, 0x1, 0x3, 0x4, and 0x5 are allowed and must be in Message Type order as defined by <xref target="F3411" format="default"/>. These messages <bcp14>MUST</bcp14> include the Message Type and Protocol Version octet and <bcp14>MUST NOT</bcp14> include the Message Counter octet (thus are fixed at 25 octets in length).</t>
        <section anchor="wrapped-count-format-validation" numbered="true" toc="default">
          <name>Wrapped Count and Format Validation</name>
          <t>When decoding a DRIP Wrapper on a receiver, a calculation of the number of messages wrapped and a validation <bcp14>MUST</bcp14> be performed by using the number of octets (defined as <tt>wrapperLength</tt>) between the <em>VNA Timestamp by UA</em> and the <em>UA DET</em> as shown in <xref target="wrapper-check" format="default"/>.</t>
          <figure anchor="wrapper-check">
            <name>Pseudocode for Wrapper Validation and Number of Messages Calculation</name>

<sourcecode name="" type="pseudocode" markers="true"><![CDATA[
if (wrapperLength MOD 25) != 0 {
  return DECODE_FAILURE;
}
wrappedCount = wrapperLength / 25;
if (wrappedCount == 0) {
  // DECODE_SUCCESS; treat as DRIP Wrapper over extended transport
}
else if (wrappedCount > 4) {
  return DECODE_FAILURE;
} else {
  // DECODE_SUCCESS; treat as standard DRIP Wrapper
}
]]></sourcecode>
          </figure>
        </section>
        <section anchor="extended-wrapper" numbered="true" toc="default">
          <name>Wrapper over Extended Transports</name>
          <t>When using Extended Transports, an optimization to DRIP Wrapper can be made to sign over co-located data in an ASTM Message Pack (Message Type 0xF).</t>
          <t>To perform this optimization, the <em>UA-Signed Evidence Structure</em> is filled with the ASTM Messages to be in the ASTM Message Pack, the signature is generated, and then the <em>Evidence</em> field is cleared, leaving the encoded form shown in <xref target="set-sig" format="default"/>.</t>
          <figure anchor="set-sig">
            <name>DRIP Wrapper over Extended Transports</name>
            <artwork align="center" name="" type="" alt=""><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|                      VNB Timestamp by UA                      |
+---------------+---------------+---------------+---------------+
|                      VNA Timestamp by UA                      |
+---------------+---------------+---------------+---------------+
|                                                               |
|                              UA                               |
|                        DRIP Entity Tag                        |
|                                                               |
+---------------+---------------+---------------+---------------+
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                          UA Signature                         |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
|                                                               |
+---------------+---------------+---------------+---------------+
]]></artwork>
          </figure>
          <t>To verify the signature, the receiver <bcp14>MUST</bcp14> concatenate all the messages in the Message Pack (excluding the Authentication Message found in the same Message Pack) in ASTM Message Type order and set the <em>Evidence</em> field of the <em>UA-Signed Evidence Structure</em> before performing signature verification.</t>
          <t>The functionality of a Wrapper in this form is equivalent to Message Set Signature (Authentication Type 0x3) when running over Extended Transports. The Wrapper provides the same format but over both Extended and Legacy Transports, which allows the transports to be similar. Message Set Signature also implies using the ASTM validator system architecture, which depends on Internet connectivity for verification that the receiver may not have at the time an Authentication Message is received. This is something the Wrapper, and all DRIP Authentication Formats, avoid when the UA key is obtained via a DRIP Link Authentication Message.</t>
        </section>
        <section anchor="wrapper-limitations" numbered="true" toc="default">
          <name>Wrapper Limitations</name>
          <t>The primary limitation of the Wrapper is the bounding of up to four ASTM Messages that can be sent within it. Another limitation is that the format cannot be used as a surrogate for messages it is wrapping due to the potential that an Observer on the ground does not support DRIP. Thus, when a Wrapper is being used, the wrapped data must effectively be sent twice, once as a single-framed message (as specified in <xref target="F3411" format="default"/>) and again within the Wrapper.</t>
        </section>
      </section>
      <section anchor="drip-manifest" numbered="true" toc="default">
        <name>DRIP Manifest</name>
        <t>This SAM Type is used to create message manifests that contain hashes of previously sent ASTM Messages.</t>
        <t>By hashing previously sent messages and signing them, we gain trust in a UA's previous reports without retransmitting them. This is a way to evade the limitation of a maximum of four messages in the Wrapper (<xref target="wrapper-limitations" format="default"/>) and greatly reduce overhead.</t>
        <t>Observers <bcp14>MUST</bcp14> hash all received ASTM Messages and cross-check them against hashes in received Manifests.</t>
        <t>Judicious use of a Manifest enables an entire Broadcast RID message stream to be strongly authenticated with less than 100% overhead relative to a completely unauthenticated message stream (see <xref target="drip-recommendations" format="default"/> and <xref target="operational-proof" format="default"/>).</t>
        <t>The <em>Evidence</em> field of the <em>UA-Signed Evidence Structure</em> (<xref target="bas" format="default"/>) is populated with 8-octet hashes of <xref target="F3411" format="default"/> Broadcast RID messages (up to 11) and three special hashes (<xref target="block-hashes" format="default"/>). All of these hashes <bcp14>MUST</bcp14> be concatenated to form a contiguous octet sequence in the <em>Evidence</em> field. It is <bcp14>RECOMMENDED</bcp14> that the maximum number of ASTM Message Hashes used be 10 (see <xref target="eleven-astm-messages" format="default"/>).</t>
        <t>The <em>Previous Manifest Hash</em>, <em>Current Manifest Hash</em>, and <em>DRIP Link (BE: HDA, UA) Hash</em> <bcp14>MUST</bcp14> always come before the <em>ASTM Message Hashes</em> as seen in <xref target="manifest-fig" format="default"/>.</t>
        <t>An Observer <bcp14>MUST</bcp14> use the Manifest to verify each ASTM Message hashed therein that it has previously received. It can do this without having received them all. A Manifest <bcp14>SHOULD</bcp14> typically encompass a single transmission cycle of messages being sent; see <xref target="operational-recommendations" format="default"/> and <xref target="operational-proof" format="default"/>.</t>
        <figure anchor="manifest-fig">
          <name>DRIP Manifest Evidence Structure</name>
          <artwork align="center" name="" type="" alt=""><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|                       Previous Manifest                       |
|                              Hash                             |
+---------------+---------------+---------------+---------------+
|                       Current Manifest                        |
|                              Hash                             |
+---------------+---------------+---------------+---------------+
|                      DRIP Link (BE: HDA, UA)                  |
|                              Hash                             |
+---------------+---------------+---------------+---------------+
|                                                               |
.                                                               .
.                      ASTM Message Hashes                      .
.                                                               .
|                                                               |
+---------------+---------------+---------------+---------------+
]]></artwork>
        </figure>
<dl>     
<dt><em>Previous Manifest Hash</em>:</dt><dd><t>(8 octets)</t>
        <t>Hash of the previously sent Manifest Message.</t></dd>
        <dt><em>Current Manifest Hash</em>:</dt><dd><t>(8 octets)</t>
          <t>Hash of the current Manifest Message.</t></dd>
        <dt><em>DRIP Link (BE: HDA, UA)</em>:</dt><dd><t>(8 octets)</t>
          <t>Hash of the DRIP Link Authentication Message carrying <tt>BE: HDA, UA</tt> (see <xref target="drip-link" format="default"/>).</t></dd>
        <dt><em>ASTM Message Hash</em>:</dt><dd><t>(8 octets)</t>
          <t>Hash of a single full ASTM Message using hash operations described in <xref target="hash-op" format="default"/>.</t></dd></dl>
        <section anchor="hash-count-format-validation" numbered="true" toc="default">
          <name>Hash Count and Format Validation</name>
          <t>When decoding a DRIP Manifest on a receiver, a calculation of the number of hashes and a validation can be performed by using the number of octets between the <em>UA DET</em> and the <em>VNB Timestamp by UA</em> (defined as    
<tt>manifestLength</tt>) such as shown in <xref target="manifest-check" format="default"/>.</t>
          <figure anchor="manifest-check">
            <name>Pseudocode for Manifest Sanity Check and Number of Hashes Calculation</name>

<sourcecode name="" type="pseudocode" markers="true"><![CDATA[
if (manifestLength MOD 8) != 0 {
  return DECODE_FAILURE
}
hashCount = (manifestLength / 8) - 3;
]]></sourcecode>

          </figure>
        </section>
        <section anchor="block-hashes" numbered="true" toc="default">
          <name>Manifest Ledger Hashes</name>
          <t>
  The following three special hashes are included in all Manifests:</t>
	  <ul>
  <li>the <em>Previous Manifest Hash</em> links to the previous Manifest.</li>
  <li>the <em>Current Manifest Hash</em> is of the Manifest in which it appears.</li>
  <li>the <em>DRIP Link (BE: HDA, UA) Hash</em> ties the endorsed UA key to the Manifest chain.</li></ul>
<t>
  The Previous and Current hashes act as a ledger of provenance for the Manifest chain,
  which should be traced back if the Observer and UA were within Broadcast RID wireless range
  of each other for an extended period of time.</t>

<t>The <em>DRIP Link (BE: HDA, UA)</em> is included so there is a direct signature by the UA over the Broadcast Endorsement (see <xref target="drip-link" format="default"/>). Typical operation would expect that the list of <em>ASTM Message Hashes</em> contain nonce-like data. To enforce a binding between the <tt>BE: HDA, UA</tt> and avoid trivial replay attack vectors (see <xref target="replay-attacks" format="default"/>), at least one <em>ASTM Message Hash</em> <bcp14>MUST</bcp14> be from an <xref target="F3411"/> message that satisfies the fourth requirement in <xref target="drip-recommendations" format="default"/>. At least once per Observation Session, the Observer must process that message as specified in <xref target="drip-recommendations" format="default"/>.</t>

        </section>
        <section anchor="hash-op" numbered="true" toc="default">
          <name>Hash Algorithms and Operation</name>
          <t>The hash algorithm used for the Manifest is the same hash algorithm used in creation of the DET <xref target="RFC9374" format="default"/> that is signing the Manifest. This is encoded as part of the DET using the HHIT Suite ID.</t>
          <t>DETs that use cSHAKE128 <xref target="NIST.SP.800-185" format="default"/> compute the hash as follows:</t>
	  <artwork name="" type="" align="left" alt=""><![CDATA[
   cSHAKE128(ASTM Message, 64, "", "Remote ID Auth Hash")
]]></artwork>
          <t>For ORCHID Generation Algorithms (OGAs) other than "5" (EdDSA/cSHAKE128) <xref target="RFC9374" format="default"/>, use the construct appropriate for the associated hash. For example, the hash for "2" (ECDSA/SHA-384) is computed as follows:</t>
	  <artwork name="" type="" align="left" alt=""><![CDATA[
   Ltrunc( SHA-384( ASTM Message | "Remote ID Auth Hash" ), 8 )
]]></artwork>

<t>When building a Manifest, this process <bcp14>MUST</bcp14> be followed:</t>

<ol type="1" >
<li><t>The <em>Previous Manifest Hash</em></t> 
<ol type="a"><li>is filled with a random nonce if and only if this is the first manifest being generated;</li>
<li>otherwise, it contains the previous manifest's <em>Current Manifest Hash</em>.</li></ol></li>
<li>The <em>Current Manifest Hash</em> is filled with null.</li>
<li><em>ASTM Message Hashes</em> are filled per <xref target="legacy-transport-hashing"/> or <xref target="extended-transport-hashing"/>.</li>
<li>A hash, as defined above in this section, is calculated over the <em>Previous Manifest Hash</em>, <em>Current Manifest Hash</em> (null filled), and <em>ASTM Message Hashes</em>.</li>
<li>The <em>Current Manifest Hash</em> (null filled) is replaced with the hash generated in Step r.</li></ol>


          <section anchor="legacy-transport-hashing" numbered="true" toc="default">
            <name>Legacy Transport Hashing</name>
            <t>Under this transport, DRIP hashes the full ASTM Message being sent over the Bluetooth Advertising frame. This is the 25-octet object that starts with the Message Type and Protocol Version octet along with the 24 octets of message data. The hash <bcp14>MUST NOT</bcp14> include the Message Counter octet.</t>
            <t>For paged ASTM Messages (currently only Authentication Messages), all of the pages are concatenated together in Page Number order and hashed as one object.</t>
          </section>
          <section anchor="extended-transport-hashing" numbered="true" toc="default">
            <name>Extended Transport Hashing</name>
            <t>Under this transport, DRIP hashes the full ASTM Message Pack (Message Type 0xF) regardless of its content. The hash <bcp14>MUST NOT</bcp14> include the Message Counter octet.</t>
          </section>
        </section>
      </section>
      <section anchor="drip-frame" numbered="true" toc="default">
        <name>DRIP Frame</name>
        <t>
  This SAM Type is defined to enable use of the <em>UA-Signed Evidence Structure</em>
  (<xref target="bas" format="default"/>) in the future beyond the previously defined formats (Wrapper and
  Manifest) by the inclusion of a single octet to signal the format of <em>Evidence</em>
  data (up to 111 octets).</t>

        <t>The content format of <em>Frame Evidence Data</em> is not defined in this document. Other specifications <bcp14>MUST</bcp14> define the contents and register for a <em>Frame Type</em>. At the time of publication (2024), there are no defined Frame Types; only an Experimental range has been defined.</t>
        <t>Observers <bcp14>MUST</bcp14> check the signature of the structure (<xref target="bas" format="default"/>) per <xref target="ua-attestation" format="default"/> and <bcp14>MAY</bcp14>, if the specification of <em>Frame Type</em> is known, parse the content in <em>Frame Evidence Data</em>.</t>
        <figure anchor="frame-fig">
          <name>DRIP Frame</name>
          <artwork align="center" name="" type="" alt=""><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|  Frame Type   |                                               |
+---------------+                                               .
.                      Frame Evidence Data                      .
.                                                               .
|                                                               |
+---------------+---------------+---------------+---------------+
]]></artwork>
        </figure>
<dl>
        <dt><em>Frame Type</em>:</dt><dd><t>(1 octet)</t>
          <t>
      As shown in <xref target="frame-fig" format="default"/>, the <em>Frame Type</em> takes the first octet, which 
      leaves 111 octets available for <em>Frame Evidence Data</em>.  See <xref target="iana-drip-registry" format="default"/> for Frame Type allocations.</t></dd></dl>
      </section>
    </section>
    <section anchor="fec-details" numbered="true" toc="default">
      <name>Forward Error Correction</name>
      <t>For Broadcast RID, FEC is provided by the lower layers in Extended Transports. The Bluetooth 4.x Legacy Transport does not support FEC, so the following application-level scheme is used with DRIP Authentication to add some FEC. When sending data over a medium that does not have underlying FEC, for example Bluetooth 4.x, this section <bcp14>MUST</bcp14> be used.</t>
      <t>The Bluetooth 4.x lower layers have error detection but not correction. Any frame in which Bluetooth detects an error is dropped and not delivered to higher layers (in our case, DRIP). Thus it can be treated as an erasure.</t>
      <t>DRIP standardizes a single page FEC scheme using XOR parity across all page data of an Authentication Message. This allows the correction of a single erased page in an Authentication Message. If more than a single page is missing, then handling of an incomplete Authentication Message is determined by higher layers.</t>
      <t>Other FEC schemes, to protect more than a single page of an Authentication Message or multiple <xref target="F3411" format="default"/> Messages, are left for future standardization if operational experience proves it necessary and/or practical.</t>
      <t>The data added during FEC is not included in the <em>Authentication Data / Signature</em>, but instead in the <em>Additional Data</em> field of <xref target="astm-auth" format="default"/>. This may cause the Authentication Message to exceed 9 pages, up to a maximum of 16 pages.</t>
      <section anchor="enc-single-page" numbered="true" toc="default">
        <name>Encoding</name>
        <t>When encoding, two things are <bcp14>REQUIRED</bcp14>:</t>
        <ol spacing="normal" type="1">
	  <li>The FEC data <bcp14>MUST</bcp14> start on a new Authentication
	  Page. To do this, the results of parity encoding <bcp14>MUST</bcp14>
	  be placed in the <em>Additional Data</em> field of <xref
	  target="astm-auth" format="default"/> with null padding before it to
	  line up with the next page. The <em>Additional Data Length</em>
	  field <bcp14>MUST</bcp14> be set to <tt>number of padding octets +
	  number of parity octets</tt>.</li>
          <li>The <em>Last Page Index</em> field (in Page 0)
          <bcp14>MUST</bcp14> be incremented from what it would have been
          without FEC by the number of pages required for the <em>Additional
          Data Length</em> field, null padding, and FEC.</li>
        </ol>
        <t>To generate the parity, a simple XOR operation using the previous parity page and current page is used. Only the 23-octet <em>Authentication Payload</em> field of <xref target="astm-auth-page" format="default"/> is used in the XOR operations. For Page 0, a 23-octet null pad is used for the previous parity page.</t>
        <t><xref target="fig-single-fec" format="default"/> shows an example of the last two pages (out of N) of an Authentication Message using DRIP Single Page FEC. The <em>Additional Data Length</em> is set to 33, as there are always 23 octets of FEC data and there are 10 octets of padding in this example to line it up into Page N.</t>
        <figure anchor="fig-single-fec">
          <name>Example Single Page FEC Encoding</name>
          <artwork align="center" name="" type="" alt=""><![CDATA[
Page N-1:
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|  Page Header  |                                               |
+---------------+                                               |
|                Authentication Data / Signature                |
|                                                               |
|               +---------------+---------------+---------------+
|               |    ADL=33     |                               |
+---------------+---------------+                               |
|                          Null Padding                         |
|                                                               |
+---------------+---------------+---------------+---------------+


Page N:
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+---------------+---------------+
|  Page Header  |                                               |
+---------------+                                               |
|                                                               |
|                     Forward Error Correction                  |
|                                                               |
|                                                               |
|                                                               |
+---------------+---------------+---------------+---------------+
]]></artwork>
        </figure>
      </section>
      <section anchor="dec-single-page" numbered="true" toc="default">
        <name>Decoding</name>
        <t>Frame decoding is independent of the transmit media. However, the decoding process can determine from the first Authentication Page that there may be a Bluetooth 4.x FEC page at the end. The decoding process <bcp14>MUST</bcp14> test for the presence of FEC and apply it as follows.</t>
        <t>To determine if FEC has been used, a check of the <em>Last Page Index</em> is performed. In general, if the <em>Last Page Index</em> field is one greater than that necessary to hold <em>Length</em> octets of Authentication Data, then FEC has been used. Note that if <em>Length</em> octets are exhausted exactly at the end of an Authentication Page, the <em>Additional Data Length</em> field will occupy the first octet of the following page. The remainder of this page will be null padded under DRIP to align the FEC to its own page. In this case, the <em>Last Page Index</em> will have been incremented once for initializing the <em>Additional Data Length</em> field and once for the FEC page, for a total of two additional pages, as in the last row of <xref target="tbl-page-counts" format="default"/>.</t>
        <t>To decode FEC in DRIP, a rolling XOR is used on each <em>Authentication Page</em> received in the current Authentication Message. A Message Counter, outside of the ASTM Message but specified in <xref target="F3411" format="default"/>, is used to signal a different Authentication Message and to correlate pages to messages. This Message Counter is only a single octet in length, so it will roll over (to 0x00) after reaching its maximum value (0xFF). If only a single page is missing in the Authentication Message the resulting parity octets should be the data of the erased page.</t>
        <t>Authentication Page 0 contains various important fields, only located on that page, that help decode the full ASTM Authentication Message. If Page 0 has been reconstructed, the <em>Last Page Index</em> and <em>Length</em> fields <bcp14>MUST</bcp14> be validated by DRIP. The pseudocode in <xref target="decode-pseudo" format="default"/> can be used for both checks.</t>
        <figure anchor="decode-pseudo">
          <name>Pseudocode for Decode Checks</name>

<sourcecode name="" type="pseudocode" markers="true"><![CDATA[
function decode_check(auth_pages[], decoded_lpi, decoded_length) {
  // check decoded_lpi does not exceed maximum value
  if (decoded_lpi >= 16) {
    return DECODE_FAILURE
  }
  
  // check that decoded length does not exceed DRIP maximum value
  if (decoded_length > 201) {
    return DECODE_FAILURE
  }

  // grab the page at index where length ends and extract its data
  auth_data = auth_pages[(decoded_length - 17) / 23].data
  // find the index of last auth byte
  last_auth_byte = (17 + (23 * last_auth_page)) - decoded_length

  // look for non-nulls after the last auth byte
  if (auth_data[(last_auth_byte + 2):] has non-nulls) {
    return DECODE_FAILURE
  }

  // check that byte directly after last auth byte is null
  if (auth_data[last_auth_byte + 1] equals null) {
    return DECODE_FAILURE
  }

  // we set our presumed Additional Data Length (ADL)
  presumed_adl = auth_data[last_auth_byte + 1]
  // use the presumed ADL to calculate a presumed 
  //Last Page Index (LPI, a field defined in [F3411])
  presumed_lpi = (presumed_adl + decoded_length - 17) / 23

  // check that presumed LPI and decoded LPI match
  if (presumed_lpi not equal decoded_lpi) {
    return DECODE_FAILURE
  }
  return DECODE_SUCCESS
}
]]></sourcecode>
        </figure>
      </section>
      <section anchor="fec-limitations" numbered="true" toc="default">
        <name>FEC Limitations</name>
        <t>The worst-case scenario is when the <em>Authentication Data / Signature</em> ends perfectly on a page boundary (Page N-1). This means the <em>Additional Data Length</em> would start the next page (Page N) and have 22 octets worth of null padding to align the FEC to begin at the start of the next page (Page N+1). In this scenario, an entire page (Page N) is being wasted just to carry the <em>Additional Data Length</em>.</t>
      </section>
    </section>
    <section anchor="reqs" numbered="true" toc="default">
      <name>Requirements and Recommendations</name>
      <section anchor="legacy-transports" numbered="true" toc="default">
        <name>Legacy Transports</name>
        <t>Under DRIP, the goal is to bring reliable receipt of the paged Authentication Message using Legacy Transports. FEC (<xref target="fec-details" format="default"/>) <bcp14>MUST</bcp14> be used, per mandated RID rules (for example, the US FAA RID Rules <xref target="FAA-14CFR" format="default"/>), when using Legacy Transports (such as Bluetooth 4.x).</t>
        <t>Under <xref target="F3411" format="default"/>, Authentication Messages are transmitted at the static rate (at least every 3 seconds). Any DRIP Authentication Messages containing dynamic data (such as the DRIP Wrapper) <bcp14>MAY</bcp14> be sent at the dynamic rate (at least every 1 second).</t>
      </section>
      <section anchor="extended-transports" numbered="true" toc="default">
        <name>Extended Transports</name>
        <t>Under the ASTM specification, Extended Transports of RID must use the Message Pack (Message Type 0xF) format for all transmissions. Under Message Pack, ASTM Messages are sent together (in Message Type order) in a single frame (up to 9 single-frame equivalent messages under Legacy Transports). Message Packs are required by <xref target="F3411" format="default"/> to be sent at a rate of 1 per second (like dynamic messages).</t>
        <t>Message Packs are sent only over Extended Transports that provide FEC. Thus, the DRIP decoders will never be presented with a Message Pack from which a constituent Authentication Page has been dropped; DRIP FEC could never provide benefit to a Message Pack, only consume its precious payload space. Therefore, DRIP FEC (<xref target="fec-details" format="default"/>) <bcp14>MUST NOT</bcp14> be used in Message Packs.</t>
      </section>
      <section anchor="drip-recommendations" numbered="true" toc="default">
        <name>Authentication</name>
        <t>To fulfill the requirements in <xref target="RFC9153" format="default"/>, a UA <bcp14>MUST</bcp14>:</t>
        <ol spacing="normal" type="1">
	  <li>send DRIP Link (<xref target="drip-link"
	  format="default"/>) using the <em>BE: Apex, RAA</em> (partially
	  satisfying GEN-3); at least once per 5 minutes. Apex in this context
	  is the DET prefix owner.</li>
          <li>send DRIP Link (<xref target="drip-link"
          format="default"/>) using the <tt>BE: RAA, HDA</tt> (partially
          satisfying GEN-3); at least once per 5 minutes.</li>
          <li>send DRIP Link (<xref target="drip-link"
          format="default"/>) using the <tt>BE: HDA, UA</tt> (satisfying ID-5,
          GEN-1 and partially satisfying GEN-3); at least once per minute.</li>
          <li>send any other DRIP Authentication Format
          (non-DRIP Link) where the UA is dynamically signing data that is
          guaranteed to be unique, unpredictable, and easily cross checked by
          the receiving device (satisfying ID-5, GEN-1 and GEN-2); at least
          once per 5 seconds.</li>
        </ol>

<t>An Observer's receiver must verify the signature (cryptographically, as specified in <xref target="auth-dns"/>) on each of the 4 messages sent in the operations specified immediately above and the Observer <bcp14>MUST</bcp14> validate the signed content (via non-cryptographic means) of the 4th message sent in the last operation immediately above (the non-DRIP Link message).</t>

<t>These transmission, receiver verification, and Observer validation requirements collectively satisfy GEN-3.</t>

      </section>
      <section anchor="operational-recommendations" numbered="true" toc="default">
        <name>Operational</name>
        <t>UAS operation may impact the frequency of sending DRIP Authentication Messages. When a UA dwells at an approximate location, and the channel is heavily used by other devices, less frequent message authentication may be effective (to minimize RF packet collisions) for an Observer. Contrast this with a UA transiting an area, where authenticated messages <bcp14>SHOULD</bcp14> be sufficiently frequent for an Observer to have a high probability of receiving an adequate number for validation during the transit.</t>

        <t>A <bcp14>RECOMMENDED</bcp14> operational configuration (in alignment with <xref target="drip-recommendations" format="default"/>) with rationale can be found in <xref target="operational-proof" format="default"/>. It recommends the following once per second:</t>
        <ul spacing="normal">
          <li>
            <t>Under Legacy Transport:
            </t>
            <ul spacing="normal">
              <li>Two sets of those ASTM Messages required by a CAA in its jurisdiction (example: Basic ID, Location/Vector, and System) and one set of other ASTM Messages (example: Self ID, Operator ID)</li>
              <li>An FEC-protected DRIP Manifest enabling authentication of those ASTM Messages sent</li>
              <li>A single page of an FEC-protected DRIP Link</li>
            </ul>
          </li>
          <li>
            <t>Under Extended Transport:
            </t>
            <ul spacing="normal">
              <li>A Message Pack of ASTM Messages (up to 4) and a DRIP Wrapper (per <xref target="extended-wrapper" format="default"/>)</li>
              <li>A Message Pack of a DRIP Link</li>
            </ul>
          </li>
        </ul>
        <section anchor="wrapper-operations" numbered="true" toc="default">
          <name>DRIP Wrapper</name>
          <t>If DRIP Wrappers are sent, they <bcp14>MUST</bcp14> be sent in addition to any required ASTM Messages in a given jurisdiction. An implementation <bcp14>MUST NOT</bcp14> send DRIP Wrappers in place of any required ASTM Messages it may encapsulate. Thus, messages within a Wrapper are sent twice: once in the clear and once authenticated within the Wrapper.</t>
          <t>The DRIP Wrapper has a specific use case for DRIP-aware Observers. For an Observer plotting Location/Vector Messages (Message Type 0x2) on a map, display of an embedded Location/Vector Message in a DRIP Wrapper can be marked differently (e.g., via color) to signify trust in the Location/Vector data.</t>
        </section>
        <section anchor="trust-assessment" numbered="true" toc="default">
          <name>UAS RID Trust Assessment</name>
          <t>As described in <xref target="rid-trust" format="default"/>, the Observer <bcp14>MUST</bcp14> perform validation of the data being received in Broadcast RID. This is because trust in a key is different from trust that an observed UA possesses that key.</t>
          <t>A chain of DRIP Links provides trust in a key. A message, signed by that key, containing data that changes rapidly and is not predictable far in advance (relative to typical operational flight times) but that can be validated by Observers, provides trust that some agent with access to that data also possesses that key. If the validation involves correlating physical world observations of the UA with claims in that data, then the probability is high that the observed UA is (or is collaborating with or observed in real time by) the agent with the key.</t>

<t>At least once per Observation session, after signature verification of any DRIP Authentication Message containing UAS RID information elements (e.g., DRIP Wrapper, <xref target="drip-wrapper"/>), the Observer must use other sources of information to correlate against and perform validation (as specified in <xref target="drip-recommendations"/>). An example of another source of information is a visual confirmation of the UA position.</t>

          <t>When correlation of these different data streams does not match in acceptable thresholds, the data <bcp14>MUST</bcp14> be rejected as if the signature failed to validate. Acceptable threshold limits and what happens after such a rejection are out of scope for this document.</t>
        </section>
      </section>
    </section>
    <section anchor="req-sum" numbered="true" toc="default">
      <name>Summary of Addressed DRIP Requirements</name>
      <t>The following requirements as defined in <xref target="RFC9153" format="default"/> are addressed in this document:</t>
<dl>
      <dt>ID-5:</dt><dd><t>Non-spoofability</t>
        <t>Addressed using the DRIP Wrapper (<xref target="drip-wrapper" format="default"/>), DRIP Manifest (<xref target="drip-manifest" format="default"/>), or DRIP Frame (<xref target="drip-frame" format="default"/>).</t></dd>

      <dt>GEN-1:</dt><dd><t>Provable Ownership</t>

        <t>Addressed using the DRIP Link (<xref target="drip-link" format="default"/>) and DRIP Wrapper (<xref target="drip-wrapper" format="default"/>), DRIP Manifest (<xref target="drip-manifest" format="default"/>), or DRIP Frame (<xref target="drip-frame" format="default"/>).</t></dd>

      <dt>GEN-2:</dt><dd><t>Provable Binding</t>
        <t>Addressed using the DRIP Wrapper (<xref target="drip-wrapper" format="default"/>), DRIP Manifest (<xref target="drip-manifest" format="default"/>) or DRIP Frame (<xref target="drip-frame" format="default"/>).</t></dd>

      <dt>GEN-3:</dt><dd><t>Provable Registration</t>
        <t>Addressed using the DRIP Link (<xref target="drip-link" format="default"/>).</t></dd></dl>
    </section>
    <section anchor="iana-considerations" numbered="true" toc="default">
      <name>IANA Considerations</name>
      <section anchor="iana-drip-registry" numbered="true" toc="default">
        <name>IANA DRIP Registry</name>
        <t>IANA has created the "DRIP SAM Types" and "DRIP Frame Types" registries within the <eref target="https://www.iana.org/assignments/drip">"Drone Remote ID Protocol" registry group</eref>.</t>
        <dl newline="true" spacing="normal">
          <dt>DRIP SAM Types:</dt>
          <dd><t>This registry is a mirror for SAM Types containing the subset of
          allocations used by DRIP Authentication Messages. Future additions
          <bcp14>MUST</bcp14> be done through ASTM's designated registrar,
          which is ICAO <xref target="ASTM-Remote-ID" format="default"/> at the time of publication of this RFC (2024). The registration procedure for DRIP (only) SAM Types is Standards Action <xref target="RFC8126"/>. 
  Requests for new DRIP SAM Type registrations will be coordinated by IANA and the
  ASTM-designated registrar of all SAM Types before being documented in Standards Track RFCs. The following values have
          been allocated to the IETF:</t>

        <table align="center">
          <name>DRIP SAM Types</name>
          <thead>
            <tr>
              <th align="left">SAM Type</th>
              <th align="left">Name</th>
              <th align="left">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left">0x01</td>
              <td align="left">DRIP Link</td>
              <td align="left">Format to hold Broadcast Endorsements</td>
            </tr>
            <tr>
              <td align="left">0x02</td>
              <td align="left">DRIP Wrapper</td>
              <td align="left">Authenticate full ASTM Messages</td>
            </tr>
            <tr>
              <td align="left">0x03</td>
              <td align="left">DRIP Manifest</td>
              <td align="left">Authenticate hashes of ASTM Messages</td>
            </tr>
            <tr>
              <td align="left">0x04</td>
              <td align="left">DRIP Frame</td>
              <td align="left">Format for future DRIP authentication</td>
            </tr>
          </tbody>
        </table></dd>

          <dt>DRIP Frame Types:</dt>
          <dd><t>This 8-bit value registry is for Frame Types in DRIP Frame
          Authentication Messages. Future additions to this registry are to be
          made through Expert Review (<xref target="RFC8126"
          sectionFormat="of" section="4.5"/>) for values 0x01 to 0x9F
          and First Come First Served (<xref target="RFC8126"
          sectionFormat="of" section="4.4"/>) for values 0xA0 to 0xEF. The
          following values are defined:</t>
        <table align="center">
          <name>DRIP Frame Types</name>
          <thead>
            <tr>
              <th align="left">Frame Type</th>
              <th align="left">Name</th>
              <th align="left">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left">0x00</td>
              <td align="left">Reserved</td>
              <td align="left">Reserved</td>
            </tr>
            <tr>
              <td align="left">0x01 - 0xEF</td>
              <td align="left">Unassigned</td>
              <td align="left"></td>
            </tr>
	    <tr>
	      <td align="left">0xF0-0xFF</td>
	      <td align="left">Experimental</td>
	      <td align="left">Reserved for Experimental Use</td>
	      </tr> 
          </tbody>
        </table>
	  </dd></dl>
        <t>Criteria that should be applied by the designated experts includes determining whether the proposed registration duplicates existing functionality and whether the registration description is clear and fits the purpose of this registry.</t>
        <t>Registration requests <bcp14>MUST</bcp14> be sent to <eref target="mailto:drip-reg-review@ietf.org">drip-reg-review@ietf.org</eref> and be evaluated by one or more designated experts within a three-week review period. Within that review period, the designated experts will either approve or deny the registration request, and communicate their decision to the review list and IANA. Denials should include an explanation and, if applicable, suggestions to successfully register the DRIP Frame Type.</t>
        <t>Registration requests that are undetermined for a period longer than 28 days can be brought to the IESG's attention for resolution.</t>
      </section>
    </section>
    <section anchor="security-considerations" numbered="true" toc="default">
      <name>Security Considerations</name>
      <section anchor="replay-attacks" numbered="true" toc="default">
        <name>Replay Attacks</name>
        <t><xref target="F3411" format="default"/> (regardless of transport) lacks replay protection, as it more fundamentally lacks fully specified authentication. An attacker can spoof the UA sender MAC address and UAS ID, replaying (with or without modification) previous genuine messages, and/or crafting entirely new messages. Using DRIP in <xref target="F3411" format="default"/> Authentication Message framing enables verification that messages were signed with registered keys, but when naively used may be vulnerable to replay attacks. Technologies such as Single Emitter Identification can detect such attacks, but they are not readily available and can be prohibitively expensive, especially for typical Observer devices such as smartphones.</t>

<t>Replay attack detection using DRIP requires Observer devices to combine information from multiple Broadcast RID messages and from sources other than Broadcast RID. A complete chain of Link messages (<xref target="drip-link" format="default"/>) from an Endorsement root of trust to the claimed sender must be collected and verified by the Observer device to provide trust in a key. Successful signature verification, using that public key, of a Wrapper (<xref target="drip-wrapper" format="default"/>) or Manifest (<xref target="drip-manifest"/>) message, authenticating content that is nonce-like (see below), provides trust that the sender actually possesses the corresponding private key.</t>

<t>The term "nonce-like" describes data that is unique, changes frequently, is not accurately predictable long in advance, and is easily validated (i.e., can be checked quickly at low computational cost using readily available data) by the Observer. A Location/Vector Message is an obvious choice. This is described in <xref target="ua-attestation"/> and <xref target="drip-recommendations"/> (requirement 4). A Location/Vector Message <xref target="F3411"/> reporting precise UA position and velocity at a precise and very recent time can be checked by the Observer against visual observations of UA within both RF and Visual Line of Sight.</t>

<t>For normative specification of the foregoing, see Sections <xref target="rid-trust" format="counter"/> and <xref target="trust-assessment" format="counter"/>. As non-normative clarification, the requirements are satisfied as follows:</t>

<t>The public key corresponding to a given DET (i.e., the key attested in the DRIP Link (<tt>BE: HDA, UA</tt>) that is the last link in the relevant chain of DRIP Links) is used by an Observer's receiver to try to authenticate some signed message.</t>

<t>If the signature check passes,</t>
<ul empty="true">
<li><em>and</em> the message was a Wrapper or Manifest,</li>
<li><em>and</em> the wrapped or manifested message contained content that was nonce-like,</li>
<li><em>and</em> the Observer validated that content by non-cryptographic means (e.g., if the wrapped or manifested message was a Location/Vector Message and the UA was visually observed to be in approximately 
the claimed location at the reported time),</li></ul>
<t><em>only then</em> can the Observer trust that the currently observed sending UA actually possesses the corresponding private key (and thus owns the corresponding DET).</t>

        <t>Messages that pass signature verification with trusted keys could still be replays if they contain only static information (e.g., Broadcast Endorsements (<xref target="drip-link" format="default"/>), <xref target="F3411" format="default"/> Basic ID, or <xref target="F3411" format="default"/> Operator ID), or information that cannot be readily validated (e.g., <xref target="F3411" format="default"/> Self-ID). Replay of Link messages is harmless (unless sent so frequently as to cause RF data link congestion) and indeed can increase the likelihood of an Observer device collecting an entire trust chain in a short time window. Replay of other messages (<xref target="F3411" format="default"/> Basic ID, <xref target="F3411" format="default"/> Operator ID, or <xref target="F3411" format="default"/> Self-ID) remains a vulnerability, unless they are combined with messages containing nonce-like data (<xref target="F3411" format="default"/> Location/Vector or <xref target="F3411" format="default"/> System) in a Wrapper or Manifest. For specification of this last requirement, see <xref target="block-hashes" format="default"/>.</t>
      </section>
      <section anchor="wrapper-vs-manifest" numbered="true" toc="default">
        <name>Wrapper vs Manifest</name>
        <t>Implementations have a choice of using Wrapper (<xref target="drip-wrapper" format="default"/>), Manifest (<xref target="drip-manifest" format="default"/>), or a combination to satisfy the fourth requirement in <xref target="drip-recommendations" format="default"/>.</t>
        <t>
  Wrapper is an attached signature on the full content of one or more
  <xref target="F3411"/> messages, providing strong authentication.
Wrapper is an attached signature of the full content of one or more <xref target="F3411" format="default"/> messages, providing strong authentication. 

However, the size limitation means it cannot support such signatures over other Authentication Messages; thus, it cannot provide a direct binding to any part of the trust chain (Sections <xref target="rid-trust" format="counter"/> and <xref target="trust-assessment" format="counter"/>).</t>
        <t>Manifest explicitly provides the binding of the last link in the trust chain (with the inclusion of the hash of the Link containing <tt>BE: HDA, UA</tt>). The use of hashes and their length also allows for a larger number (11 vs 4) of <xref target="F3411" format="default"/> messages to be authenticated, making it more efficient compared to the Wrapper. However, the detached signature requires additional Observer overhead in storing and comparing hashes of received messages (some of which may not be received) with those in a Manifest.</t>
        <t><xref target="operational-proof" format="default"/> contains a breakdown of frame counts and an example of a schedule using both Manifest and Wrapper. Typical operation may see (as an example) 2x Basic ID, 2x Location/Vector, 2x System, 1x Operator ID and 1x Self ID broadcast per second to comply with jurisdiction mandates. Each of these messages is a single frame in size. A Link message is 8 frames long (including FEC). This is a base frame count of <strong>16 frames</strong>.</t>
        <t>When Wrapper is used, up to four of the previous messages (except the Link) can be authenticated. For this comparison, we will sign all the messages we can in two Wrappers. This results in <em>20 frames</em> (with FEC). Due to size constraints, the Link message is left unauthenticated. The total frame count using Wrappers is <strong>36 frames</strong> (wrapper frame count + base frame count).</t>
        <t>When Manifest is used, up to 10 previous messages can be authenticated. For this example, all messages (8) are hashed (including the Link) resulting in a single Manifest that is <em>9 frames</em> (with FEC). The total frame count using Manifest is <strong>25 frames</strong> (manifest frame count + base frame count).</t>
      </section>
      <section anchor="vna-timestamp-offsets-for-drip-authentication-formats" numbered="true" toc="default">
        <name>VNA Timestamp Offsets for DRIP Authentication Formats</name>
        <t>Note the discussion of VNA Timestamp offsets here is in the context of the DRIP Wrapper (<xref target="drip-wrapper" format="default"/>), DRIP Manifest (<xref target="drip-manifest" format="default"/>), and DRIP Frame (<xref target="drip-frame" format="default"/>). For DRIP Link (<xref target="drip-link" format="default"/>), these offsets are set by the DIME and have their own set of considerations in <xref target="I-D.ietf-drip-registries" format="default"/>.</t>
        <t>The offset of the <em>VNA Timestamp by UA</em> is one that needs careful consideration for any implementation. The offset should be shorter than any given flight duration (typically less than an hour) but be long enough to be received and processed by Observers (larger than a few seconds). It is recommended that 3-5 minutes should be sufficient to serve this purpose in any scenario, but it is not limited by design.</t>
      </section>
      <section anchor="dns-security" numbered="true" toc="default">
        <name>DNS Security in DRIP</name>
        <t>As stated in <xref target="protocol-desc" format="default"/> specification of particular DNS security options, transports, etc. is outside the scope of this document. 
  The main specification for DNS operations in DRIP <xref target="I-D.ietf-drip-registries" format="default"/>
  will specify applicable best common security practices 
  (e.g., from <xref target="RFC9364"/>).</t>
      </section>
    </section>
  </middle>
  <back>

    <displayreference target="I-D.ietf-drip-registries" to="DRIP-REG"/>

    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
	
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9153.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9374.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9434.xml"/>

        <reference anchor="F3411" target="https://www.astm.org/f3411-22a.html">
          <front>
            <title>Standard Specification for Remote ID and Tracking</title>
            <author>
              <organization>ASTM International</organization>
            </author>
            <date year="2022" month="July"/>
          </front>
          <seriesInfo name="ASTM" value="F3411-22A"/>
          <seriesInfo name="DOI" value="10.1520/F3411-22A"/>
        </reference>

	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>

        <reference anchor="NIST.SP.800-185" target="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-185.pdf">
          <front>
            <title>SHA-3 Derived Functions: cSHAKE, KMAC, TupleHash and ParallelHash</title>
            <author fullname="John Kelsey" surname="Kelsey"/>
            <author fullname="Shu-jen Chang" surname="Chang"/>
            <author fullname="Ray Perlner" surname="Perlner"/>
             <date month="December" year="2016"/>
          </front>
          <seriesInfo name="NIST Special Publication" value="800-185"/>
          <seriesInfo name="DOI" value="10.6028/NIST.SP.800-185"/>
        </reference>

      </references>
      <references>
        <name>Informative References</name>

<reference anchor="I-D.ietf-drip-registries" target="https://datatracker.ietf.org/doc/html/draft-ietf-drip-registries-16">
  <front>
    <title>DRIP Entity Tag (DET) Identity Management Architecture</title>
    <author fullname="Adam Wiethuechter" initials="A." surname="Wiethuechter" role="editor">
      <organization>AX Enterprize, LLC</organization>
    </author>
    <author fullname="Jim Reid" initials="J." surname="Reid">
      <organization>RTFM llp</organization>
    </author>
    <date day="31" month="May" year="2024"/>
  </front>
  <seriesInfo name="Internet-Draft" value="draft-ietf-drip-registries-16"/>
</reference>

	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8126.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9364.xml"/>

        <reference anchor="FAA-14CFR" target="https://www.govinfo.gov/content/pkg/FR-2021-01-15/pdf/2020-28948.pdf">
          <front>
            <title>Remote Identification of Unmanned Aircraft</title>
            <author>
              <organization>Federal Aviation Administration (FAA)</organization>
            </author>
            <date year="2021" month="January"/>
          </front>
        </reference>

        <reference anchor="ASTM-Remote-ID" target="https://www.icao.int/airnavigation/IATF/Pages/ASTM-Remote-ID.aspx">
          <front>
            <title>Remote ID Number Registration</title>
            <author>
              <organization>International Civil Aviation Organization (ICAO)</organization>
	    </author>
            <date year="2023" month="December"/>
          </front>
        </reference>
      </references>
    </references>

    <section anchor="auth-state-diagrams" numbered="true" toc="default">
      <name>Authentication States</name>
      <t>ASTM Authentication has only three states: None, Invalid, and Valid. This is because, under ASTM, the authentication is done by an external service hosted somewhere on the Internet so it is assumed an authoritative response will always be returned. This classification becomes more complex in DRIP with the support of "offline" scenarios where an Observer does not have Internet connectivity. With the use of asymmetric cryptography, this means that the public key (PK) must somehow be obtained. <xref target="I-D.ietf-drip-registries" format="default"/> provides more detail on how these keys are stored on the DNS and how DRIP Authentication Messages can be used to send PKs over Broadcast RID.</t>
      <t>There are a few keys of interest: the PK of the UA and the PKs of relevant DIMEs. This document describes how to send the PK of the UA over the Broadcast RID messages. The keys of DIMEs are sent over Broadcast RID using the same mechanisms (see Sections <xref target="drip-link" format="counter"/> and <xref target="drip-recommendations" format="counter"/>) but <bcp14>MAY</bcp14> be sent at a far lower rate due to potential operational constraints (such as saturation of limited bandwidth). As such, there are scenarios where part of the key-chain may be unavailable at the moment a full Authentication Message is received and processed.</t>
      <t>The intent of this informative appendix is to recommend a way to classify these various states and convey it to the user through colors and state names/text. These states can apply to either a single Authentication Message, a DET (and its associated public key), and/or a sender.</t>

      <t><xref target="tab4"/> briefly describes each state and recommends an associated color.</t>
      <table align="center" anchor="tab4">
        <name>Authentication State Names, Colors, and Descriptions</name>
        <thead>
          <tr>
            <th align="left">State</th>
            <th align="left">Color</th>
            <th align="left">Details</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">None</td>
            <td align="left">Black</td>
            <td align="left">No Authentication has been or is being received (as yet)</td>
          </tr>
          <tr>
            <td align="left">Partial</td>
            <td align="left">Gray</td>
            <td align="left">Authentication being received but missing pages</td>
          </tr>
          <tr>
            <td align="left">Unsupported</td>
            <td align="left">Brown</td>
            <td align="left">Authentication Type / SAM Type of received message not supported</td>
          </tr>
          <tr>
            <td align="left">Unverifiable</td>
            <td align="left">Yellow</td>
            <td align="left">Data needed for signature verification is missing</td>
          </tr>
          <tr>
            <td align="left">Verified</td>
            <td align="left">Green</td>
            <td align="left">Valid signature verification and content validation</td>
          </tr>
          <tr>
            <td align="left">Trusted</td>
            <td align="left">Blue</td>
            <td align="left">Evidence of Verified and DIME is marked as only registering DETs for trusted entities</td>
          </tr>
          <tr>
            <td align="left">Unverified</td>
            <td align="left">Red</td>
            <td align="left">Invalid signature verification or content validation</td>
          </tr>
          <tr>
            <td align="left">Questionable</td>
            <td align="left">Orange</td>
            <td align="left">Evidence of both"Verified and Unverified for the same claimed sender</td>
          </tr>
          <tr>
            <td align="left">Conflicting</td>
            <td align="left">Purple</td>
            <td align="left">Evidence of both Trusted and Unverified for the same claimed sender</td>
          </tr>
        </tbody>
      </table>
      <section anchor="black" numbered="true" toc="default">
        <name>None: Black</name>
        <t>The default state where authentication information has not yet been received and is not currently being received.</t>
      </section>
      <section anchor="gray" numbered="true" toc="default">
        <name>Partial: Gray</name>
        <t>A pending state where Authentication Pages are being received, but a full Authentication Message has yet to be compiled.</t>
      </section>
      <section anchor="brown" numbered="true" toc="default">
        <name>Unsupported: Brown</name>
        <t>A state wherein authentication data is being or has been received but cannot be used, as the Authentication Type or SAM Type is not supported by the Observer.</t>
      </section>
      <section anchor="yellow" numbered="true" toc="default">
        <name>Unverifiable: Yellow</name>
        <t>A pending state where a full Authentication Message has been received but other information, such as public keys to verify signatures, is missing.</t>
      </section>
      <section anchor="green" numbered="true" toc="default">
        <name>Verified: Green</name>
        <t>A state where all Authentication Messages that have been received from that claimed sender up to that point pass signature verification and the requirement of <xref target="trust-assessment" format="default"/> has been met.</t>
      </section>
      <section anchor="blue" numbered="true" toc="default">
        <name>Trusted: Blue</name>
        <t>A state where all Authentication Messages that have been received from that claimed sender up to that point have passed signature verification, the requirement of <xref target="trust-assessment" format="default"/> has been met, and the public key of the sending UA has been marked as trusted.</t>
        <t>The sending UA key will have been marked as trusted if the relevant DIMEs only register DETs (of subordinate DIMEs, UAS operators, and UA) that have been vetted as per their published registration policies, and those DIMEs have been marked, by the owner (individual or organizational) of the Observer, as per that owner's policy, as trusted to register DETs only for trusted parties.</t>
      </section>
      <section anchor="orange" numbered="true" toc="default">
        <name>Questionable: Orange</name>
        <t>A state where there is a mix of Authentication Messages received that are Verified (<xref target="green" format="default"/>) and Unverified (<xref target="red" format="default"/>).</t>
        <t>State transitions from Verified to Questionable if a subsequent message fails verification, so it would have otherwise been marked Unverified.  State transitions from Unverified to Questionable if a subsequent message passes verification or validation, so it would otherwise have been marked Verified.  It may transition from either of those states upon mixed results on the requirement of <xref target="trust-assessment" format="default"/>.</t>
      </section>
      <section anchor="red" numbered="true" toc="default">
        <name>Unverified: Red</name>
        <t>A state where all Authentication Messages that have been received from that claimed sender up to that point failed signature verification or the requirement of <xref target="trust-assessment" format="default"/>.</t>
      </section>
      <section anchor="purple" numbered="true" toc="default">
        <name>Conflicting: Purple</name>
        <t>A state where there is a mix of Authentication Messages received that are Trusted (<xref target="blue" format="default"/>) and Unverified (<xref target="red" format="default"/>) and the public key of the aircraft is marked as trusted.</t>
        <t>State transitions from Trusted to Conflicting if a subsequent message fails verification, so it would have otherwise been marked Unverified.  State transitions from Unverified to Conflicting if a subsequent message passes verification or validation and policy checks, so it would otherwise have been marked Trusted. It may transition from either of those states upon mixed results on the requirement of <xref target="trust-assessment" format="default"/>.</t>
      </section>
    </section>
    <section anchor="operational-proof" numbered="true" toc="default">
      <name>Operational Recommendation Analysis</name>
      <t>The recommendations in <xref target="operational-recommendations" format="default"/> may seem heavy-handed and specific. This informative appendix lays out the math and assumptions made that resulted in those recommendations and provides an example.</t>
	   
  <t>In all jurisdictions known to the authors of this document as of its
  publication (2024), at least the following ASTM Messages are
  required to be transmitted at least once per second:</t>
	<ul><li>Basic ID (0x1)</li>
	<li>Location (0x2)</li>
	<li>System (0x4)</li></ul>

  <t>Europe also requires:</t>
	<ul><li>Operator ID Message (0x5)</li></ul>

  <t>Japan requires not one but two Basic ID messages:</t>
	<ul><li>one carrying a manufacturer assigned serial number</li>
	<li>one carrying a CAA assigned registration number</li></ul>

 <t>Japan also requires:</t>
	<ul><li>Authentication (0x2) using their own unique scheme</li></ul>

  <t>In all jurisdictions, one further message is optional, but highly
  recommended for carriage of additional information on the
  nature of the emergency if the Emergency value is sent in
  the Operational Status field of the Location/Vector Message:</t>
	<ul><li>Self ID (0x3)</li></ul>

  <t>To improve the likelihood of successful timely receipt of
  regulator required RID data elements, most implementations
  send at a higher rate, whether by repeating the same messages
  in the same one second interval, or updating message content
  and sending messages more frequently than once per second.
  Excessive sending rate, however, could congest the RF spectrum,
  leading to collisions and counter-intuitively actually reducing
  the likelihood of timely receipt of RID data.</t>

      <section anchor="page-counts-vs-frame-counts" numbered="true" toc="default">
        <name>Page Counts vs Frame Counts</name>
        <t>There are two formulas to determine the number of Authentication Pages required.  The following formula is for Wrapper:</t>
<sourcecode name="" type="" markers="true"><![CDATA[
wrapper_struct_size = 89 + (25 * num_astm_messages)
wrapper_page_count = ceiling((wrapper_struct_size - 17) / 23) + 1
]]></sourcecode>

        <t>The following formula is for Manifest:</t>
        <sourcecode name="" type="" markers="true"><![CDATA[
manifest_struct_size = 89 + (8 * (num_astm_hashes + 3))
manifest_page_count = ceiling((manifest_struct_size - 17) / 23) + 1
]]></sourcecode>

        <t>A similar formula can be applied to Links, as they are of fixed size:</t>
        <sourcecode name="" type="" markers="true"><![CDATA[
link_page_count = ceiling((137 - 17) / 23) + 1 = 7
]]></sourcecode>

        <t>Comparing Wrapper and Manifest Authentication Message page counts against total frame counts, we have the following:</t>
        <table anchor="tbl-page-counts" align="center">
          <name>Page and Frame Counts</name>
          <thead>
            <tr>
              <th align="left">ASTM Messages</th>
              <th align="left">Wrapper (w/FEC)</th>
              <th align="left">Manifest (w/FEC)</th>
              <th align="left">ASTM Messages + Wrapper (w/FEC)</th>
              <th align="left">ASTM Messages + Manifest (w/FEC)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left">0</td>
              <td align="left">5 (6)</td>
              <td align="left">6 (7)</td>
              <td align="left">5 (6)</td>
              <td align="left">6 (7)</td>
            </tr>
            <tr>
              <td align="left">1</td>
              <td align="left">6 (7)</td>
              <td align="left">6 (7)</td>
              <td align="left">7 (8)</td>
              <td align="left">7 (8)</td>
            </tr>
            <tr>
              <td align="left">2</td>
              <td align="left">7 (8)</td>
              <td align="left">6 (7)</td>
              <td align="left">9 (10)</td>
              <td align="left">8 (9)</td>
            </tr>
            <tr>
              <td align="left">3</td>
              <td align="left">8 (9)</td>
              <td align="left">7 (8)</td>
              <td align="left">11 (12)</td>
              <td align="left">10 (11)</td>
            </tr>
            <tr>
              <td align="left">4</td>
              <td align="left">9 (10)</td>
              <td align="left">7 (8)</td>
              <td align="left">13 (14)</td>
              <td align="left">11 (12)</td>
            </tr>
            <tr>
              <td align="left">5</td>
              <td align="left">N/A</td>
              <td align="left">7 (8)</td>
              <td align="left">N/A</td>
              <td align="left">12 (13)</td>
            </tr>
            <tr>
              <td align="left">6</td>
              <td align="left">N/A</td>
              <td align="left">8 (9)</td>
              <td align="left">N/A</td>
              <td align="left">14 (15)</td>
            </tr>
            <tr>
              <td align="left">7</td>
              <td align="left">N/A</td>
              <td align="left">8 (9)</td>
              <td align="left">N/A</td>
              <td align="left">15 (16)</td>
            </tr>
            <tr>
              <td align="left">8</td>
              <td align="left">N/A</td>
              <td align="left">8 (9)</td>
              <td align="left">N/A</td>
              <td align="left">16 (17)</td>
            </tr>
            <tr>
              <td align="left">9</td>
              <td align="left">N/A</td>
              <td align="left">9 (10)</td>
              <td align="left">N/A</td>
              <td align="left">18 (19)</td>
            </tr>
            <tr>
              <td align="left">10</td>
              <td align="left">N/A</td>
              <td align="left">9 (10)</td>
              <td align="left">N/A</td>
              <td align="left">19 (20)</td>
            </tr>
            <tr>
              <td align="left">11</td>
              <td align="left">N/A</td>
              <td align="left">9 (11)</td>
              <td align="left">N/A</td>
              <td align="left">20 (22)</td>
            </tr>
          </tbody>
        </table>
        <t>Link shares the same page counts as Manifest with 5 ASTM Messages.</t>
        <section anchor="special-cases" numbered="true" toc="default">
          <name>Special Cases</name>
          <section anchor="zero-astm-messages" numbered="true" toc="default">
            <name>Zero ASTM Messages</name>
            <t>Zero ASTM Messages (see <xref target="tbl-page-counts" format="default"/>) is where Extended Wrapper (<xref target="extended-wrapper" format="default"/>) without FEC is used in Message Packs. With a maximum of nine "message slots" in a Message Pack, an Extended Wrapper fills five slots; thus it can authenticate up to four ASTM Messages co-located in the same Message Pack.</t>
          </section>
          <section anchor="eleven-astm-messages" numbered="true" toc="default">
            <name>Eleven ASTM Messages</name>
            <t>Eleven ASTM Messages (see <xref target="tbl-page-counts" format="default"/>) is where a Manifest with FEC invokes the situation mentioned in <xref target="fec-limitations" format="default"/>.</t>
            <t>Eleven is the maximum number of ASTM Message Hashes that can be supported resulting in 14 total hashes. This completely fills the <em>Evidence</em> field of the <em>UA-Signed Evidence
Structure</em> making its total size 200 octets. This fits on exactly 9 Authentication Pages (<tt>(201 - 17) / 23 == 8</tt>), so when the ADL is added, it is placed on the next page (Page 10). Per rule 1 in <xref target="enc-single-page" format="default"/>, this means that all of Page 10 is null padded (expect the ADL octet) and FEC data fills Page 11, resulting in a plus-two page count when FEC is applied.</t>
            <t>This drives the recommendation is <xref target="drip-manifest" format="default"/> to only use up to 10 ASTM Message Hashes, not 11.</t>
          </section>
        </section>
      </section>
      <section anchor="full-authentication-example" numbered="true" toc="default">
        <name>Full Authentication Example</name>
        <t>This example (<xref target="max-schedule-fig"/>) is focused on showing that 100% of ASTM Messages can be authenticated over Legacy Transports with up to 125% overhead in Authentication Pages. 
  Extended Transports are not shown in this example, because, for those,
  Authentication with DRIP is achieved using Extended Wrapper 
  (<xref target="extended-wrapper" format="default"/>).
Two ASTM Message Packs are sent in a given cycle: one containing up to four ASTM Messages and an Extended Wrapper (authenticating the pack), and one containing a Link message with a Broadcast Endorsement and up to two other ASTM Messages.</t>
        <t>This example transmit scheme covers and meets every known regulatory case enabling manufacturers to use the same firmware worldwide.</t>
        <figure anchor="max-schedule-fig">
          <name>Example of a Fully Authenticated Legacy Transport Transmit Schedule</name>
          <artwork align="center" name="" type="" alt=""><![CDATA[
+------------------------------------------------------+
|                      Frame Slots                     |
| 00 - 04           | 05 - 07       | 08 - 16 | 17     |
+-------------------+---------------+---------+--------+
| {A|B|C|D},V,S,I,O | {A|B|C|D},V,S | M[0,8]  | L/W[0] |
+-------------------+---------------+---------+--------+
| {A|B|C|D},V,S,I,O | {A|B|C|D},V,S | M[0,8]  | L/W[1] |
+-------------------+---------------+---------+--------+
| {A|B|C|D},V,S,I,O | {A|B|C|D},V,S | M[0,8]  | L/W[2] |
+-------------------+---------------+---------+--------+
| {A|B|C|D},V,S,I,O | {A|B|C|D},V,S | M[0,8]  | L/W[3] |
+-------------------+---------------+---------+--------+
| {A|B|C|D},V,S,I,O | {A|B|C|D},V,S | M[0,8]  | L/W[4] |
+-------------------+---------------+---------+--------+
| {A|B|C|D},V,S,I,O | {A|B|C|D},V,S | M[0,8]  | L/W[5] |
+-------------------+---------------+---------+--------+
| {A|B|C|D},V,S,I,O | {A|B|C|D},V,S | M[0,8]  | L/W[6] |
+-------------------+---------------+---------+--------+
| {A|B|C|D},V,S,I,O | {A|B|C|D},V,S | M[0,8]  | L/W[7] |
+-------------------+---------------+---------+--------+

A = Basic ID Message (0x0) ID Type 1
B = Basic ID Message (0x0) ID Type 2
C = Basic ID Message (0x0) ID Type 3
D = Basic ID Message (0x0) ID Type 4
V = Location/Vector Message (0x1)
I = Self ID Message (0x3)
S = System Message (0x4)
O = Operator ID Message (0x5)

L[y,z] = DRIP Link Authentication Message (0x2)
W[y,z] = DRIP Wrapper Authentication Message (0x2)
M[y,z] = DRIP Manifest Authentication Message (0x2)
  y = Start Page
  z = End Page

# = Empty Frame Slot
* = Message in DRIP Manifest Authentication Message
]]></artwork>
        </figure>
        <t>Every common required message (Basic ID, Location/Vector, and System) is sent twice along with Operator ID and Self ID in a single second. The Manifest is over all messages (8) in slots <tt>00 - 04</tt> and <tt>05 - 07</tt>.</t>
        <t>In two seconds, either a Link or Wrapper is sent. The content and order of Links and Wrappers runs as follows:</t>
        <artwork name="" type="" align="left" alt=""><![CDATA[
Link: HDA on UA
Link: RAA on HDA
Link: HDA on UA
Link: Apex on RAA
Link: HDA on UA
Link: RAA on HDA
Link: HDA on UA
Wrapper: Location/Vector (0x1), System (0x4)
Link: HDA on UA
Link: RAA on HDA
Link: HDA on UA
Link: Apex on RAA
Link: HDA on UA
Link: RAA on HDA
Link: HDA on UA
Wrapper: Location/Vector (0x1), System (0x4)
Link: IANA on UAS RID Apex
]]></artwork>
        <t>After perfect receipt of all messages for a period of 8 seconds,
  all messages sent during that period have been authenticated using the Manifest
  (except for the Authentication Messages themselves).
  Within 136 seconds, the entire Broadcast Endorsement chain
  is received and can be validated. Interspersed in this schedule
  are 4 messages sent not only in their basic <xref target="F3411"/> form, but also
  in DRIP Wrapper messages, together with their attached signatures,
  to defend against the possibility of attack against the detached signatures
  provided by the Manifest messages.</t>
        <section anchor="raw-example" numbered="true" toc="default">
          <name>Raw Example</name>
          <t>Assuming the following DET and HI:</t>
          <artwork name="" type="" align="left" alt=""><![CDATA[
2001:3f:fe00:105:a29b:3ff4:2226:c04e
b5fef530d450dedb59ebafa18b00d7f5ed0ac08a81975034297bea2b00041813
]]></artwork>
          <t>The following ASTM Messages are to be sent in a single second:</t>
          <artwork name="" type="" align="left" alt=""><![CDATA[
0240012001003ffe000105a29b3ff42226c04e000000000000
12000000000000000000000000000000000000000060220000
32004578616d706c652053656c662049440000000000000000
420000000000000000000100000000000000000010ea510900
52004578616d706c65204f70657261746f7220494400000000
0240012001003ffe000105a29b3ff42226c04e000000000000
12000000000000000000000000000000000000000060220000
420000000000000000000100000000000000000010ea510900
]]></artwork>
          <t>This is a Link with FEC that would be spread out over 8 seconds:</t>
          <artwork name="" type="" align="left" alt=""><![CDATA[
2250078910ea510904314b8564b17e66662001003ffe000105
2251a29b3ff42226c04eb5fef530d450dedb59ebafa18b00d7
2252f5ed0ac08a81975034297bea2b000418132001003ffe00
22530105b82bf1c99d87273103fc83f6ecd9b91842f205c222
2254dd71d8e165ad18ca91daf9299a73eec850c756a7e9be46
2255f51dddfa0f09db7bfdde14eec07c7a6dd1061c1d5ace94
2256d9ad97940d280000000000000000000000000000000000
2257a03b0f7a6feb0d198167045058cfc49f73129917024d22
]]></artwork>
          <t>This is a Wrapper with FEC that would be spread out over 8 seconds:</t>
          <artwork name="" type="" align="left" alt=""><![CDATA[
2250078b10ea510902e0dd7c6560115e671200000000000000
22510000000000000000000000000060220000420000000000
2252000000000100000000000000000010ea5109002001003f
2253fe000105a29b3ff42226c04ef0ecad581a030ca790152a
22542f08df5762a463e24a742d1c530ec977bbe0d113697e2b
2255b909d6c7557bdaf1227ce86154b030daadda4a6b8474de
22569a62f6c375020826000000000000000000000000000000
2257f5e8eebcb04f8c2197526053e66c010d5d7297ff7c1fe0
]]></artwork>
          <t>This is the Manifest with FEC sent in the same second as the original messages:</t>
          <artwork name="" type="" align="left" alt=""><![CDATA[
225008b110ea510903e0dd7c6560115e670000000000000000
2251d57594875f8608b4d61dc9224ecf8b842bd4862734ed01
22522ca2e5f2b8a3e61547b81704766ba3eeb651be7eafc928
22538884e3e28a24fd5529bc2bd4862734ed012ca2e5f2b8a3
2254e61547b81704766ba3eeb62001003ffe000105a29b3ff4
22552226c04efb729846e7d110903797066fd96f49a77c5a48
2256c4c3b330be05bc4a958e9641718aaa31aeabad368386a2
22579ed2dce2769120da83edbcdc0858dd1e357755e7860317
2258e7c06a5918ea62a937391cbfe0983539de1b2e688b7c83
]]></artwork>
        </section>
      </section>
    </section>

    <section anchor="acknowledgments" numbered="false" toc="default">
      <name>Acknowledgments</name>
<t>The authors acknowledge the following individuals:</t>
      <ul spacing="normal">
        <li><t><contact fullname="Ryan Quigley"/>, <contact fullname="James
        Mussi"/>, and <contact fullname="Joseph Stanton"/> of AX Enterprize,
        LLC for early prototyping to find holes in earlier drafts of this
        specification.</t></li>
        <li><t><contact fullname="Carsten Bormann"/> for the simple approach of using bit-column-wise
        parity for erasure (dropped frame) FEC.</t></li>
        <li><t><contact fullname="Soren Friis"/> for pointing out that Wi-Fi implementations would not always give access to the MAC Address, as was originally used in calculation of the hashes for DRIP Manifest. Also, for confirming that Message Packs (0xF) can only carry up to 9 ASTM frames worth of data (9 Authentication Pages).</t></li>
        <li><t><contact fullname="Gabriel Cox"/> (chair of the working group that produced <xref target="F3411" format="default"/>) for reviewing the specification for the SAM Type request as the ASTM Designated Expert.</t></li>
        <li><t><contact fullname="Mohamed Boucadair"/> (Document Shepherd) for his many patches and comments.</t></li>
        <li><t><contact fullname="Eric Vyncke"/> (DRIP AD) for his guidance regarding the document's path to publication.</t></li></ul>

<t>The authors also thank the following reviewers:</t>
          <ul spacing="normal">
            <li><t><contact fullname="Rick Salz (secdir)"/></t></li>
            <li><t><contact fullname="Matt Joras (genart)"/></t></li>
            <li><t><contact fullname="Di Ma (dnsdir)"/></t></li>
            <li><t><contact fullname="Gorry Fairhurst (tsvart)"/></t></li>
            <li><t><contact fullname="Carlos Bernardos (intdir)"/></t></li>
            <li><t><contact fullname="Behcet Sarikaya (iotdir)"/></t></li>
            <li><t><contact fullname="Martin Duke (IESG)"/></t></li>
            <li><t><contact fullname="Roman Danyliw (IESG)"/></t></li>
            <li><t><contact fullname="Murray Kucherawy (IESG)"/></t></li>
            <li><t><contact fullname="Erik Kline (IESG)"/></t></li>
            <li><t><contact fullname="Warren Kumari (IESG)"/></t></li>
            <li><t><contact fullname="Paul Wouters (IESG)"/></t></li>
          </ul>
    </section>

  </back>

</rfc>
